
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Preloads -->
  <link rel="preload" href="https://i.ibb.co/fK0ZtJT/balloon.png" as="image" />
  <link rel="preload" href="assets/audio/song1.mp3" as="audio" />
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" as="script">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js" as="script">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/TextPlugin.min.js" as="script">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js" as="script">

  <!-- Preconnect for fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Preload + load Google Fonts -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&family=Comic+Neue:wght@700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&family=Comic+Neue:wght@700&display=swap">
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" ></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js" ></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/TextPlugin.min.js" ></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js" ></script>
  
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/TextPlugin.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/Draggable.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>


    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>A Special Day for My Love!</title>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/TextPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

    <style>
    
        /* ---
        Part 1: Core Styles, Variables, and New Backgrounds
        --- */
        
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: rgba(27, 27, 46, 0.8);
            --card-background: rgba(42, 42, 68, 0.85);
            --text-color: #e0e0e0;
            --heading-color: #ffffff;
            --accent-color: #FC7F03;
            --accent-color-dark: #c51162;
            --heart-color: #ff4081;
            --shadow-color: rgba(224, 64, 251, 0.1);
            --font-primary: 'Comic Neue', sans-serif;
            --font-secondary: 'Playfair Display', serif;
            --font-creative: 'Comic Neue', cursive, sans-serif;
            --aurora-1: #1a1a2e;
            --aurora-2: #16213e;
            --aurora-3: #0f3460;
            --aurora-4: #e94560;
            --aurora-5: #c51162;
        }

        /* --- Base Setup --- */
        body {
            font-family: var(--font-primary);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: var(--primary-color);
            overflow-x: hidden;
            cursor: none; /* Custom cursor will handle visibility */
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }

       
        #scroll-progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 0.3125em;
            background: linear-gradient(to right, var(--accent-color), var(--heart-color));
            z-index: 9999;
            transition: width 0.1s ease-out, opacity 0.5s ease-out; /* Added opacity transition */
        }
         /* --- Aurora Background --- */
        #aurora-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(125deg, var(--aurora-1), var(--aurora-2), var(--aurora-3), var(--aurora-4), var(--aurora-5));
            background-size: 400% 400%;
            animation: gradient-animation 25s ease infinite;
            z-index: -2;
        }
        
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes glowPulse {
            0%, 100% {
              box-shadow: 0 0 25px rgba(224, 64, 251, 0.3), 0 0 40px rgba(252, 127, 3, 0.15);
              }
            50% {
              box-shadow: 0 0 35px rgba(224, 64, 251, 0.6), 0 0 60px rgba(252, 127, 3, 0.25);
              }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        /* --- MODIFIED: Preloader --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--accent-color);
            gap: 20px;
             /* Hide ECG overflow */
        }
        
        #preloader-heart-container {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #preloader-heart {
            width: 100px;
            height: 100px;
            color: var(--heart-color);
            filter: drop-shadow(0 0 10px var(--heart-color));
            opacity: 0; /* Animated with GSAP */
            transform-origin: center center;
        }
        
        #ecg-container {
            position: absolute;
            width: 150vw;
            height: 170px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1; /* Ensure it’s above the preloader background but below the heart */
        }
              #ecg-line {
              fill: none;
              stroke: url(#ecg-gradient);
              stroke-width: 3;
              stroke-linecap: round;
              stroke-linejoin: round;
              opacity: 0.9;
              filter: drop-shadow(0 0 10px #00ffe7);
          }
        #ecg-container, .loader-text, #loader-progress {
            opacity: 0; /* Hidden initially */
            transition: opacity 0.3s ease;
        }
        #preloader-heart-container {
            z-index: 2; /* Ensure heart and play button are above ECG */
        }

        .loader-text {
            font-family: var(--font-creative);
            font-size: 1.7em;
            opacity: 0;
            text-shadow: 0 0 5px rgba(255,255,255,0.3);
            text-align: center;
            margin: 0 1em;
        }   
        #loader-progress {
            font-family: var(--font-creative);
            font-size: 1.3em;
            font-weight: 700;
            color: #FFD700; /* Golden text to match border */
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            opacity: 0;
            /* Container styling */
            background: rgba(27, 27, 46, 0.8); /* Slightly darker background */
            border: 3px solid #FFD700;
            border-radius: 50px;
            padding: 15px 30px;
            /* Multi-layer golden glow */
            box-shadow: 
                0 0 5px #FFD700,
                0 0 15px #FFD700,
                0 0 25px rgba(255, 215, 0, 0.6),
                0 0 40px rgba(255, 215, 0, 0.3);
            /* Smooth pulsating animation */
            animation: goldenPulse 1.5s ease-in-out infinite alternate;
        }

        /* Enhanced glow animation */
        @keyframes goldenPulse {
            0% {
                box-shadow: 
                    0 0 5px #FFD700,
                    0 0 15px #FFD700,
                    0 0 25px rgba(255, 215, 0, 0.6),
                    0 0 40px rgba(255, 215, 0, 0.3);
                border-color: #FFD700;
            }
            100% {
                box-shadow: 
                    0 0 10px #FFD700,
                    0 0 25px #FFD700,
                    0 0 40px rgba(255, 215, 0, 0.8),
                    0 0 60px rgba(255, 215, 0, 0.4);
                border-color: #FFD700; /* Slightly brighter gold at peak */
            }
        }

        /* --- Custom Cursor --- */
        #custom-cursor {
            position: fixed;
            width: 25px;
            height: 25px;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s, background-color 0.3s, opacity 0.3s, backdrop-filter 0.3s;
            z-index: 9999;
            backdrop-filter: blur(1px);
        }
        body:hover #custom-cursor { opacity: 1; }
        #custom-cursor.expand {
            width: 50px;
            height: 50px;
            background-color: rgba(224, 64, 251, 0.3);
        }

        

        /* --- Birthday Celebration Play Button --- */
        #celebration-play-btn {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            z-index: 10001;
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            gap: 15px;
            opacity: 0;
            cursor: pointer;
            background: rgba(27, 27, 46, 0.7);
            padding: 30px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 25px rgba(224, 64, 251, 0.3), 0 0 40px rgba(252, 127, 3, 0.15);
            animation: glowPulse 4s ease-in-out infinite;
        }

        #celebration-play-btn .icon {
            width: 80px;
            height: 80px;
            background: var(--accent-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        #celebration-play-btn:hover .icon {
            transform: scale(1.1);
            background: var(--accent-color-dark);
        }

        #celebration-play-btn svg {
            width: 45px;
            height: 45px;
            fill: white;
            margin-left: 5px;
        }

        #celebration-play-btn .text {
            font-family: var(--font-creative);
            font-size: 1.8em;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        /* --- General Layout & Typography --- */
        header {
            text-align: center;
            padding: 100px 0 60px;
            position: relative;
        }
        header h1 {
          text-align: center;
            font-family: var(--font-creative);
            font-size: 3.5em;
            max-width: 90%;             
            color: var(--heading-color);
            font-weight: 700;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(224, 64, 251, 0.4);
            margin: 0 0.3em;
            padding: 0.5em 1em;
            background: -webkit-linear-gradient(top left, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(224, 64, 251, 0.3), 0 0 40px rgba(252, 127, 3, 0.15);
            display: inline-block;
            text-align: center;
            animation: glowPulse 4s ease-in-out infinite;
            backdrop-filter: blur(4px);
        }
        header h1 .char {
            display: inline-block;
        }
        header p {
          text-align: center;
            font-size: 1.3em;
            margin-top: 15px;
            font-weight: 300;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        h2 {
          text-align: center;
            font-family: var(--font-primary);
            font-size: 2.8em;
            color: var(--heading-color);
            text-align: center;
            margin-top: 0;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(224, 64, 251, 0.3);
        }

        /* --- Card Layout & 3D Effect --- */
        .card {
            background-color: var(--card-background);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 40px 0;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
            transition: box-shadow 0.4s ease;
            transform-style: preserve-3d;
        }
        .card:hover {
            box-shadow: 0 15px 50px rgba(224, 64, 251, 0.25);
        }
        
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(50px);
        }

        #countdown {
            text-align: center;
            font-size: 2.6em;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            perspective: 500px;
        }
        #countdown > div {
            display: flex;
            flex-direction: column;
            min-width: 140px;
            background: rgba(27, 27, 46, 0.7);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #countdown .value {
            font-weight: 600;
            color: #FFDF8E;
            font-size: 1.85em;
            line-height: 1;
        }
        #countdown #milliseconds {
            font-size: 1.4em;
            color: var(--heart-color);
        }
        #countdown .label {
            font-size: 0.8em;
            text-transform: uppercase;
            font-weight: 400;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        #message p {
            font-size: 1.1em;
            line-height: 1.8;
            text-align: center;
        }
        #message-signature {
            font-style: italic;
            margin-top: 25px;
            white-space: pre-wrap;
            font-size: 1.2em;
            color: var(--accent-color);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .photo-grid .photo-item {
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            aspect-ratio: 1 / 1;
        }
        .photo-grid img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease, filter 0.4s ease;
        }
        .photo-grid .photo-item:hover img {
            transform: scale(1.1);
            filter: brightness(1.15);
        }
        
        #modal-container {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
        }
        #modal-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
        }
        #modal-image {
            max-width: 100%;
            max-height: 80vh;
            display: block;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(224, 64, 251, 0.4);
        }
        #modal-caption {
            color: white;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2em;
            padding: 0 10px;
        }
        #close-modal, #modal-prev, #modal-next {
            position: absolute;
            cursor: pointer;
            color: white;
            font-size: 2.5em;
            background: rgba(0,0,0,0.4);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            transition: background-color 0.2s, transform 0.2s;
        }
        #close-modal:hover, #modal-prev:hover, #modal-next:hover {
            background: rgba(224, 64, 251, 0.7);
            transform: scale(1.1);
        }
        #close-modal { top: 15px; right: 15px; font-family: 'Comic Neue', cursive; line-height: 50px;}
        #modal-prev, #modal-next { top: 50%; transform: translateY(-50%); font-family: 'Comic Neue', cursive;}
        #modal-prev { left: 15px; }
        #modal-next { right: 15px; }
        
        .timeline {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px 0;
        }
        .timeline::after {
            content: '';
            position: absolute;
            width: 4px;
            background-color: var(--accent-color);
            opacity: 0.3;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -2px;
            border-radius: 2px;
        }
        .timeline-item {
            padding: 10px 40px;
            position: relative;
            width: 50%;
            box-sizing: border-box ;
        }
        .timeline-item:nth-child(odd) {
            left: 0;
            text-align: right;
        }
        .timeline-item:nth-child(even) {
            left: 50%;
            text-align: left;
        }
        .timeline-item::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            right: -10px;
            background-color: var(--heading-color);
            border: 4px solid var(--accent-color);
            top: 25px;
            border-radius: 50%;
            z-index: 1;
            transition: transform 0.3s ease;
        }
        .timeline-item:nth-child(even)::after {
            left: -10px;
        }
        .timeline-item:hover::after {
            transform: scale(1.2);
        }
        .timeline-content {
            padding: 20px;
            background: rgba(27, 27, 46, 0.7);
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .timeline-content:hover {
            background: rgba(42, 42, 68, 1);
        }
        .timeline-content h3 {
            margin-top: 0;
            color: var(--accent-color);
        }
        .timeline-content .date {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .reasons-container {
            text-align: center;
        }
        #reason-text {
            font-size: 1.5em;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            font-style: italic;
            color: var(--heading-color);
            transition: opacity 0.4s ease;
        }
        
        #new-reason-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            font-weight: 600;
            font-size: 1.1em;
            margin-top: 20px;
            position: relative; 
            overflow: hidden;   
            -webkit-tap-highlight-color: transparent; 
            filter: url(#liquid-goo);
        }

        #new-reason-btn:hover:not(:disabled) {
            background-color: var(--accent-color-dark);
            transform: translateY(-3px);
        }

        #new-reason-btn:active:not(:disabled) {
            transform: translateY(0) scale(0.95);
        }

        #new-reason-btn:disabled {
            cursor: not-allowed;
            filter: brightness(0.8) url(#liquid-goo);
        }

        .cooldown-blob {
            position: absolute;
            bottom: -20px; 
            left: 50%;
            width: 30px; 
            height: 30px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.3) 60%, rgba(0, 150, 255, 0.5) 100%);
            border-radius: 50%;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.4), 0 0 12px rgba(100, 200, 255, 0.5);
            transform-origin: center center;
            transform: translate(-50%, 0) scale(0);
        }

        .music-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .track-info {
            display: flex;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 450px;
        }
        #track-art {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }
        .music-player.is-playing #track-art {
            transform: scale(1.05);
        }
        #track-details { overflow: hidden; }
        #track-title {
            font-size: 1.3em;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--heading-color);
        }
        #track-artist { font-size: 1em; color: #b0b0b0; }

        #audio-visualizer {
            width: 100%;
            max-width: 450px;
            height: 60px;
            display: block;
        }

        .progress-container {
            width: 100%;
            max-width: 450px;
            height: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            cursor: pointer;
        }
        #progress-bar {
            width: 0;
            height: 100%;
            background: var(--accent-color);
            border-radius: 5px;
            transition: width 0.1s linear;
        }
        .player-controls {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        .player-controls button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            line-height: 0;
            transition: transform 0.15s ease;
        }
        .player-controls button:active {
            transform: scale(0.9);
        }

        .player-controls svg { width: 28px; height: 28px; fill: var(--text-color); transition: fill 0.2s; }
        .player-controls button:hover svg { fill: var(--heading-color); }
        #play-pause-btn {
            background: var(--accent-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s, transform 0.2s;
        }
        #play-pause-btn:hover { background: var(--accent-color-dark); transform: scale(1.05); }
        #play-pause-btn:active {
            transform: scale(0.95);
        }
        #play-pause-btn svg { fill: white; width: 30px; height: 30px; }
        
        #wish-wall {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-bottom: 25px;
            min-height: 50px;
        }
        .wish-bubble {
            background: rgba(224, 64, 251, 0.1);
            border: 1px solid rgba(224, 64, 251, 0.3);
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.95em;
            cursor: grab;
            touch-action: none;
            user-select: none;
            position: relative;
        }

        .wish-bubble.is-dragging {
            cursor: grabbing;
            opacity: 0.3;
            z-index: 1000;
        }
        .wish-bubble-clone {
            position: fixed;
            pointer-events: none;
            z-index: 10001;
            transform: translate(-50%, -50%);
        }
        #delete-zone {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            width: 80px;
            height: 80px;
            background: rgba(255, 23, 68, 0.6);
            border: 2px dashed #ff1744;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s ease;
        }
        #delete-zone.visible {
            opacity: 1;
            transform: translateX(-50%) scale(1);
            pointer-events: all;
        }
        #delete-zone.over {
            background: rgba(255, 23, 68, 0.9);
            transform: translateX(-50%) scale(1.2);
        }
        #delete-zone svg {
            width: 40px;
            height: 40px;
            fill: #fff;
        }

        #wish-form {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        #wish-input {
            flex-grow: 1;
            max-width: 450px;
            border: 1px solid rgba(255,255,255,0.2);
            background-color: rgba(27, 27, 46, 0.7);
            color: var(--text-color);
            border-radius: 8px;
            padding: 14px;
            font-family: var(--font-primary);
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #wish-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--shadow-color);
        }
        #wish-form button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px 25px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            font-weight: 600;
        }
        #wish-form button:hover { background-color: var(--accent-color-dark); }
        #wish-form button:active {
            transform: scale(0.95);
        }
        
        footer {
            text-align: center;
            padding: 50px 20px;
            font-size: 0.9em;
            color: var(--text-color);
            opacity: 0.7;
            position: relative;
            z-index: 2;
        }

        #page-scroll-tracker {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: linear-gradient(to right, #ff4081, #FC7F03);
            z-index: 99999;
            transition: width 0.2s ease-out, opacity 0.5s ease-out;
            opacity: 0; /* Start hidden */
        }
        .comic-neue {
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
        }
        
        /* ---
Part Z: View Toggles ---
--- */

/* ---
Part Z: View Toggles ---
--- */

#view-toggles {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 9998; /* Below the scrollbar but above most content */
    display: flex; /* ❗️CORRECTION: This makes the container visible */
    flex-direction: row;
    gap: 5px;
}



.view-toggle-btn {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: rgba(27, 27, 46, 0.7);
    border: 2px solid var(--accent-color);
    backdrop-filter: blur(5px);
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
    font-size: 13px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    line-height: 1;
    /* Add these two lines for the animation */
    opacity: 0;
    transform: scale(0);
}

/* Add this new rule right after the one above */
#toggle-balloons-btn {
    display: none; /* Keep it hidden until the birthday */
}


.view-toggle-btn:hover {
    transform: scale(1.1);
}

.view-toggle-btn .icon-on {
    display: inline;
}
.view-toggle-btn .icon-off {
    display: none;
    font-weight: bold;
    color: white;
}

/* Toggled OFF state */
.view-toggle-btn.toggled-off {
    background-color: rgba(224, 64, 251, 0.4);
    border-color: var(--heart-color);
}
.view-toggle-btn.toggled-off .icon-on {
    display: none;
}
.view-toggle-btn.toggled-off .icon-off {
    display: inline;
}

/* Helper class to hide elements */
.hidden-element {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}


        @media (max-width: 768px) {
            header h1 { font-size: 3em; }
            h2 { font-size: 2.2em; }
            .card { padding: 30px; }
            #countdown { font-size: 2em; gap: 10px; }
            #countdown > div { min-width: 100px; padding: 15px; }
            #wish-form { flex-direction: column; }
            .timeline::after { left: 30px; }
            .timeline-item { width: 100%; padding-left: 70px; padding-right: 15px; }
            .timeline-item:nth-child(odd), .timeline-item:nth-child(even) { left: 0; text-align: left; }
            .timeline-item::after { left: 20px; }
        }
        
        @media (max-width: 480px) {
            body { cursor: default; }
            #custom-cursor { display: none; }
            header h1 { font-size: 2.5em; }
            header { padding: 80px 0 40px; }
            .photo-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
            #countdown { font-size: 1.2em; }
            #countdown > div { min-width: 70px; }
        }
        
        body.no-scroll {
            overflow: hidden;
        }
            
        #play-button {
            position: absolute;
            width: 50px;
            height: 50px;
            color: var(--heading-color);
            opacity: 0.8;
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.6));
        }

        #play-button:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        #preloader-heart-container {
            position: relative;
            width: 150px;
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #preloader-heart {
            width: 130px;
            height: 130px;
            color: var(--heart-color);
            filter: drop-shadow(0 0 10px var(--heart-color));
            opacity: 1; 
            transform-origin: center center;
        }

        #truth-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        .rainbow-balloon {
            position: absolute;
            bottom: -300px; /* Start off-screen */
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 260px;
            background-image: url('https://i.ibb.co/fK0ZtJT/balloon.png'); /* Using a hosted image for simplicity */
            background-size: contain;
            background-repeat: no-repeat;
            cursor: pointer;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
            will-change: transform;
            z-index: 10005;
        }

        #truth-cancel-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid white;
            background: rgba(0,0,0,0.5);
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 10005;
            opacity: 0;
            transform: scale(0);
            transition: transform 0.3s, background 0.3s;
        }

        #truth-cancel-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: var(--heart-color);
        }

        .truth-word {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-family: var(--font-creative);
            font-size: 8em;
            color: white;
            text-shadow: 0 0 20px var(--accent-color);
            opacity: 0;
            pointer-events: none;
            z-index: 10004;
        }
        #word-i     { font-size: 5em; }
        #word-lubhh { font-size: 3em; }
        #word-booh  { font-size: 3.5em; }

        @keyframes drip {
            to {
                transform: translateY(30px);
                opacity: 0;
            }
        }
        #truth-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }
        
        #content-wrapper {
            pointer-events: none;
        }

        #content-wrapper > header,
        #content-wrapper > main,
        #content-wrapper > footer {
            pointer-events: auto;
        }

        /* ---
        Part X: Cosmic Oracle Quote Section
        --- */

        #oracle h2 {
            margin-bottom: 50px;
            text-shadow: 0 0 15px var(--accent-color-dark);
        }

        .oracle-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
            perspective: 1500px;
        }

        .oracle-card-wrapper {
            width: 250px;
            height: 400px;
            perspective: 1500px;
        }

        .oracle-card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s ease;
            cursor: pointer;
        }

        .oracle-card .oracle-front,
        .oracle-card .oracle-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        .oracle-card .oracle-front {
            background: linear-gradient(145deg, rgba(42, 42, 68, 0.85), rgba(27, 27, 46, 0.9));
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 20px rgba(252, 127, 3, 0.3), inset 0 0 15px rgba(252, 127, 3, 0.2);
            transition: all 0.5s ease;
        }

        .oracle-card-wrapper:hover .oracle-front {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 0 35px rgba(252, 127, 3, 0.5), inset 0 0 20px rgba(252, 127, 3, 0.3);
            border-color: #FFD700;
        }

        .oracle-card .oracle-icon {
            font-size: 4em;
            filter: drop-shadow(0 0 10px var(--accent-color));
            margin-bottom: 20px;
        }

        .oracle-card .oracle-front h3 {
            font-family: var(--font-secondary);
            font-size: 1.8em;
            margin: 10px 0 5px;
            color: var(--heading-color);
        }

        .oracle-card .oracle-front p {
            font-size: 1.1em;
            color: var(--text-color);
        }

        .oracle-card .oracle-back {
            background: var(--primary-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: rotateY(180deg);
            justify-content: space-between;
        }

        .oracle-card.is-flipped {
            transform: rotateY(180deg);
        }

        .oracle-back .quote-text {
            font-family: var(--font-secondary);
            font-size: 1.3em;
            line-height: 1.6;
            font-style: italic;
            flex-grow: 1;
            display: flex;
            align-items: center;
            color: var(--heading-color);
        }

        .oracle-back .quote-author {
            font-size: 0.60em;
            font-weight: bold;
            color: var(--accent-color);
            align-self: flex-end;
            text-align:center;
            width:100%;
        }

        .quote-nav {
            position: absolute;
            bottom: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .quote-nav button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quote-nav button:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }

        .quote-nav button:active {
            transform: scale(0.95);
        }

        @media (max-width: 900px) {
            .oracle-container {
                flex-direction: column;
                align-items: center;
            }
        }
        

                /* --- Part Y: Balloon Pop Game --- */

        /* ADD THIS NEW CSS */
        #game-ui.hidden-element {
            display: none !important;
        }

        #game-main-menu,
        #game-high-scores-screen,
        #game-history-screen {
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 25px;
            background: var(--secondary-color);
            padding: 40px 60px;
            border-radius: 25px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            text-align: center;
            color: white;
            width: 90%;
            max-width: 500px;
        }
        
        #game-main-menu h2,
        #game-high-scores-screen h2,
        #game-history-screen h2 {
            font-size: 3em;
            margin: 0;
            color: var(--heading-color);
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 300px;
        }

                .menu-btn {
            font-family: var(--font-creative);
            font-size: 1.5em;
            padding: 15px 25px;
            border-radius: 30px;
            border: 2px solid var(--accent-color);
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--accent-color);
            color: white;
        }

        .menu-btn:hover {
            transform: scale(1.05);
            background-color: var(--accent-color-dark);
        }

        .menu-btn:active {
            transform: scale(0.95);
            background-color: var(--heart-color); /* Turns red on tap */
            border-color: var(--heart-color);
        }

        .menu-btn.secondary {
            background-color: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.4);
            margin-top: 10px;
        }
        
        .menu-btn.secondary:hover {
             background-color: rgba(255,255,255,0.2);
        }

        .game-instructions {
            font-size: 1.2em;
            margin-top: -15px;
            max-width: 350px;
        }

        #high-scores-list,
        #game-history-list {
            width: 100%;
            max-height: 40vh;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            font-size: 1.2em;
        }
        
        #high-scores-list p,
        #game-history-list p {
            margin: 0 0 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        #high-scores-list span,
        #game-history-list span {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        #game-end-screen p:nth-of-type(2) {
            display: none; /* Hide the "New High Score" message by default */
        }

        #game-end-screen p.new-high-score-achieved {
            display: block; /* Show it when the class is added */
            color: #FFD700;
            font-size: 1.4em;
            animation: newHighScorePulse 1s ease-in-out infinite alternate;
        }

        @keyframes newHighScorePulse {
            to { transform: scale(1.1); text-shadow: 0 0 15px #FFD700; }
        }

        /* The rest of your game styles continue here... */


        #play-game-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9998;
            padding: 5px 15px;
            font-family: var(--font-creative);
            font-size: 0.8em;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            transform: scale(0); /* Initially hidden */
            opacity: 0;
            
            background-color: rgba(255, 255, 255, 0.15);
            color: #FFD700;
            border: 2px solid #FFD700;
            backdrop-filter: blur(10px);
        }   

        #play-game-btn:hover {
            background-color: var(--accent-color-dark);
            transform: scale(1.05) translateY(-2px) !important;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        #play-game-btn:active {
            transform: scale(0.98) !important;
        }

        #game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10100; /* On top of almost everything */
            background-color: rgba(26, 26, 46, 0.3);
            backdrop-filter: blur(5px);
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Larger values, smaller labels */
#game-stats span {
    font-size: 0.85em;            /* Label size */
}

#game-score, 
#game-timer, 
#game-high-score-ui {
    font-size: 1.5em;            /* Value size */
    font-weight: bold;
    margin-top: 4px;             /* Space between label and value */
}

#game-pause-btn {
    width: 50px;                /* Larger pause button */
    height: 50px;
    font-size: 1.3em;
}

#game-quit-now-btn {
    width: 30px;                /* Smaller quit button */
    height: 30px;
    font-size: 0.9em;
}



        #game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-creative);
            font-size: 1.5em;
            color: white;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        
        #game-stats {
            display: flex;
            gap: 30px;
            background: rgba(0,0,0,0.3);
            padding: 8px 18px;
            border-radius: 20px;
        }
        #game-stats span {
    text-shadow: 0 0 8px currentColor; /* Glow effect */
}

        #game-controls button {
            background: rgba(0,0,0,0.3);
            border: 2px solid white;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #game-controls button:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }

        #game-pause-screen, #game-end-screen {
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            background: var(--secondary-color);
            padding: 40px 60px;
            border-radius: 25px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            text-align: center;
            color: white;
        }
        
        #game-pause-screen h2, #game-end-screen h2 {
            font-size: 3em;
            margin: 0;
            color: var(--heading-color);
        }
        
        #game-end-screen p {
            font-size: 1.5em;
            margin: 5px 0;
        }

                #game-pause-screen button, #game-end-screen button {
            font-family: var(--font-creative);
            font-size: 1.3em;
            padding: 15px 35px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--accent-color);
            color: white;
        }

        #game-pause-screen button:hover, #game-end-screen button:hover {
            background-color: var(--accent-color-dark);
            transform: scale(1.05);
        }

        #game-pause-screen button:active, #game-end-screen button:active {
            transform: scale(0.95);
            background-color: var(--heart-color); /* Turns red on tap */
        }

        
        #game-end-screen #game-quit-btn {
            background-color: rgba(255,255,255,0.2);
        }
        
                #game-end-screen #game-quit-btn:hover {
            background-color: rgba(255,255,255,0.4);
        }

        /* 🎯 ADD THESE NEW STYLES */
        #game-quit-confirm-screen {
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 18px;
            background: var(--secondary-color);
            padding: 35px 55px;
            border-radius: 25px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            text-align: center;
            color: white;
        }

        #game-quit-confirm-screen h2 {
            font-size: 3em;
            margin: 0;
            color: var(--heading-color);
        }
        
        #game-quit-confirm-screen p {
            font-size: 1.5em;
            margin: 5px 0;
        }

        .game-controls-wrapper {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

                #game-quit-confirm-screen button {
            font-family: var(--font-creative);
            font-size: 1.3em;
            padding: 15px 35px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--accent-color);
            color: white;
        }

        #game-quit-confirm-screen button:hover {
            transform: scale(1.05);
        }
        
        #game-quit-confirm-screen button:active {
            transform: scale(0.95);
            background-color: var(--heart-color); /* Turns red on tap */
        }


        #quit-confirm-no-btn {
            background-color: rgba(255,255,255,0.2);
        }

        #quit-confirm-no-btn:hover {
            background-color: rgba(255,255,255,0.4);
        }
        
                /* --- Styles for Game Difficulty Selection --- */
        #game-start-screen {
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            background: var(--secondary-color);
            padding: 40px 60px;
            border-radius: 25px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            text-align: center;
            color: white;
        }

        #game-start-screen h2 {
            font-size: 3em;
            margin: 0;
            color: var(--heading-color);
        }

        .difficulty-buttons {
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
}

                .difficulty-btn {
            font-family: var(--font-creative);
            font-size: 1.3em;
            padding: 15px 35px;
            border-radius: 30px;
            border: 2px solid white;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        .difficulty-btn:hover {
            transform: scale(1.05);
            border-color: var(--accent-color);
        }

        .difficulty-btn:active {
            transform: scale(0.95);
            background-color: var(--heart-color); /* Turns red on tap */
            border-color: var(--heart-color);
            color: white;
        }


        #difficulty-easy:hover { background-color: #69f0ae; }
        #difficulty-medium:hover { background-color: #ffab40; }
        #difficulty-hard:hover { background-color: #ff5252; }
        
        
        /* --- Styles for Heart Canvas --- */
#heart-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* Behind main content, above aurora */
    pointer-events: none; /* Allows clicks to pass through */
}

/* --- Style for the new Balloon Canvas --- */
#balloon-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2; /* Higher than the heart canvas to appear on top */
    pointer-events: auto; /* Allows the canvas itself to be clicked for popping */
}


        /* ---
        Part Y: Balloon Pop Game ---
        --- */

        .balloon-particle {
            position: absolute;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            cursor: pointer;
            box-shadow: inset -10px -10px 0 rgba(0,0,0,0.07);
            transition: transform 0.2s ease-out;
            will-change: transform;
        }

        .balloon-particle:hover {
            transform: scale(1.1);
        }

        .balloon-particle::after { /* This creates the little tie at the bottom */
            content: "";
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 12px;
            background: inherit;
            filter: brightness(0.8);
            border-radius: 50%;
        }
        
        /* Define the colors for the balloons */
        .balloon-particle.red { background: radial-gradient(circle at 30% 30%, #ff8a80, #ff1744); }
        .balloon-particle.blue { background: radial-gradient(circle at 30% 30%, #82b1ff, #2979ff); }
        .balloon-particle.green { background: radial-gradient(circle at 30% 30%, #b9f6ca, #00e676); }
        .balloon-particle.yellow { background: radial-gradient(circle at 30% 30%, #ffff8d, #ffea00); }
        .balloon-particle.purple { background: radial-gradient(circle at 30% 30%, #ea80fc, #d500f9); }
        .balloon-particle.orange { background: radial-gradient(circle at 30% 30%, #ffd180, #ff9100); }


                /* --- Styles for the in-game balloons --- */
        .balloon-particle {
            position: absolute; /* This is the key fix! */
            bottom: -150px; /* Start off-screen at the bottom */
            will-change: transform;
            cursor: pointer;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            /* A pseudo-element for the balloon shine */
            background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7), transparent 40%);
        }
        
        /* Adding distinct colors for game balloons */
        .balloon-particle.red { background-color: #ff5252; }
        .balloon-particle.blue { background-color: #448aff; }
        .balloon-particle.green { background-color: #69f0ae; }
        .balloon-particle.yellow { background-color: #ffd600; }
        .balloon-particle.purple { background-color: #e040fb; }
        .balloon-particle.orange { background-color: #ffab40; }

        #game-end-screen #game-quit-btn:hover {
            background-color: rgba(255,255,255,0.4);
        }
        
/* ---
Part A: Birthday Feature Styles
--- */

/* Styles for the popups */
#birthday-intro-popup,
#surprise-hint-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10003; /* Very high to be on top */
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none; /* Allows clicks to pass through the container */
}

#birthday-intro-popup {
    /* This overlay will temporarily block clicks for a few seconds */
    pointer-events: auto; 
}


#birthday-intro-popup .popup-content,
#surprise-hint-popup .popup-content {
    background: var(--secondary-color);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 30px 40px;
    border-radius: 20px;
    border: 2px solid var(--accent-color);
    max-width: 90%;
    width: 600px;
    text-align: center;
    font-family: var(--font-primary);
    font-size: 1.5em;
    color: var(--heading-color);
    box-shadow: 0 0 50px var(--shadow-color);
    line-height: 1.6;
}

@media (max-width: 768px) {
    #birthday-intro-popup .popup-content,
    #surprise-hint-popup .popup-content {
        font-size: 1.2em;
    }
}

/* Styles for the spinning message card and slider */
#message {
    /* These are crucial for the 3D spin effect */
    transform-style: preserve-3d;
    position: relative; /* To position the slider inside */
    padding-bottom: 120px; /* Add more space for the new slider design */
}

.message-slider-container {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.message-slider-track {
    width: 100%;
    height: 16px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 50px;
    position: relative;
    border: 2px solid rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
}

.message-slider-progress {
    height: 100%;
    width: 0; /* Controlled by JS */
    background: linear-gradient(90deg, var(--accent-color) 0%, var(--heart-color) 100%);
    border-radius: 50px;
    box-shadow: 0 0 10px var(--accent-color);
}

.message-slider-handle {
    position: absolute;
    top: 50%;
    left: 0; /* Starts at the beginning */
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    cursor: grab;
    touch-action: none; /* Important for mobile dragging */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: var(--primary-color);
    transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
}

.message-slider-handle.dragging {
    cursor: grabbing;
    transform: translateY(-50%) scale(1.15);
    box-shadow: 0 8px 25px rgba(0,0,0,0.5);
}

.slider-prompt {
    font-size: 1em;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
    animation: pulsePrompt 2.5s ease-in-out infinite;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
}

@keyframes pulsePrompt {
    0%, 100% {
        opacity: 0.8;
        transform: scale(1);
    }
    50% {
        opacity: 1;
        transform: scale(1.05);
    }
}



/* Styles for the new Surprise Section */
#surprise-section {
    /* It will inherit styles from .card, these are additions */
    text-align: center;
}

#surprise-heading, #surprise-subheading {
    text-align: center;
}

#surprise-reveal-timer {
    font-family: var(--font-creative);
    font-size: 2.2em;
    color: var(--accent-color);
    margin: 25px 0;
    text-shadow: 0 0 10px var(--accent-color);
}

.surprise-content {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
}

#surprise-image {
    width: 100%;
    max-width: 500px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    /* Initial blurred state */
    filter: blur(25px);
}

#surprise-link {
    font-size: 1.4em;
    color: white;
    text-decoration: none;
    padding: 10px 20px;
    border-bottom: 2px dashed var(--accent-color);
    /* Initial blurred and unclickable state */
    filter: blur(8px);
    opacity: 0.6;
    pointer-events: none;
}

#loader-progress {
    transform: translateY(40px);
}

header {
  text-align: center;
  padding: 100px 0 60px;
  position: relative;
  display: flex;              /* Add flexbox */
  flex-direction: column;     /* Stack children vertically */
  align-items: center;        /* Center children horizontally */
  justify-content: center;    /* Center children vertically */
}







    </style>
</head>

<body>
  <div id="view-toggles">
    <button id="toggle-hearts-btn" class="view-toggle-btn" title="Toggle Hearts">
        <span class="icon-on">❤️</span>
        <span class="icon-off">×</span>
    </button>
    <button id="toggle-balloons-btn" class="view-toggle-btn" title="Toggle Balloons">
        <span class="icon-on">🎈</span>
        <span class="icon-off">×</span>
    </button>
</div>

    <svg style="position: absolute; width: 0; height: 0;">
      <defs>
        <filter id="liquid-goo">
          <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
          <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 21 -9" result="goo" />
          <feComposite in="SourceGraphic" in2="goo" operator="atop"/>
        </filter>
      </defs>
    </svg>

    <div id="scroll-progress-bar"></div>
<div id="page-scroll-tracker"></div>
<div id="aurora-background"></div>
<canvas id="heart-canvas"></canvas>
<canvas id="balloon-canvas"></canvas> 




   
    <div id="custom-cursor"></div>

    <button id="play-game-btn">Play Game 🎮</button>

    <div id="celebration-play-btn">
        <div class="icon">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
        <div class="text">Start Celebration!</div>
    </div>

    <div id="preloader">
        <div id="preloader-heart-container">
            <svg id="preloader-heart" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
            <svg id="play-button" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
            </svg>
        </div>
        <svg id="ecg-container" viewBox="0 0 400 120" preserveAspectRatio="xMidYMid meet">
            <defs>
                <clipPath id="ecg-mask">
                    <rect id="ecg-mask-rect" x="-400" y="0" width="400" height="120" />
                </clipPath>
                <linearGradient id="ecg-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#00ffe7; stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#00ff87; stop-opacity:1" />
                </linearGradient>
            </defs>
            <path id="ecg-path" d="M -80,20 H 130 L 150,0 L 170,55 L 180,15 L 190,25 L 210,20 H 420" />
            <g clip-path="url(#ecg-mask)">
                <use href="#ecg-path" id="ecg-line" />
            </g>
        </svg>
        <div class="loader-text">Preparing something special...</div>
        <div id="loader-progress">0%</div>
    </div>
    <audio id="heartbeat-audio" loop>
        <source src="assets/audio/heartbeat.mp3" type="audio/mpeg">
    </audio>
    
    <div id="content-wrapper" style="visibility: hidden;">
        <header id="main-header">
            <h1 id="main-heading"></h1>
            <p id="header-subtitle"></p>
        </header>

        <main class="container">
            <section id="dynamic-section" class="card animate-on-scroll"></section>

            <section id="message" class="card animate-on-scroll">
                <h2 id="message-heading"></h2>
                <p id="message-body"></p>
                <p id="message-signature"></p>
            </section>

            <section id="journey" class="card animate-on-scroll">
                <h2>Our Journey Together</h2>
                <div class="timeline">
                    </div>
            </section>

 <!--Uncomment this-->
           <!--<section id="gallery" class="card animate-on-scroll">
               <h2>Our Cherished Moments</h2>
                <div id="photo-grid" class="photo-grid"></div>
            </section> -->
            
            <section id="reasons" class="card animate-on-scroll">
                <h2>A Few Reasons Why I Love You</h2>
                <div class="reasons-container">
                    <p id="reason-text">Click the button to see a reason!</p>
                    <button id="new-reason-btn">Show Me Another</button>
                </div>
            </section>

            <section id="playlist" class="card animate-on-scroll">
                <h2>Our Playlist (Coming soon..😂💞)</h2>
                <div class="music-player">
                    <div class="track-info">
                        <div id="track-art"></div>
                        <div id="track-details">
                            <div id="track-title"></div>
                            <div id="track-artist"></div>
                        </div>
                    </div>
                    <canvas id="audio-visualizer"></canvas>
                    <div class="progress-container">
                        <div id="progress-bar"></div>
                    </div>
                    <div class="player-controls">
                        <button id="prev-btn" title="Previous">
                            <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path></svg>
                        </button>
                        <button id="play-pause-btn" title="Play/Pause">
                            <svg id="play-pause-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
                        </button>
                        <button id="next-btn" title="Next">
                           <svg viewBox="0 0 24 24"><path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"></path></svg>
                        </button>
                    </div>
                </div>
            </section>
            
            <section id="oracle" class="card animate-on-scroll">
                <h2>Whispers from the Universe</h2>
                                <div class="oracle-container">
                    <div class="oracle-card-wrapper">
                        <div class="oracle-card" id="dev-card">
                            <div class="oracle-front">
                                <div class="oracle-icon">🔮</div>
                                <h3>The Phoenix</h3>
                                <p>On Self-Growth</p>
                            </div>
                            <div class="oracle-back">
                                <p class="quote-text"></p>
                                <p class="quote-author"></p>
                                <div class="quote-nav">
                                    <button class="prev-quote">&lt;</button>
                                    <button class="next-quote">&gt;</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="oracle-card-wrapper">
                        <div class="oracle-card" id="love-card">
                            <div class="oracle-front">
                                <div class="oracle-icon">💞</div>
                                <h3>The Lovers</h3>
                                <p>On Romance</p>
                            </div>
                            <div class="oracle-back">
                                <p class="quote-text"></p>
                                <p class="quote-author"></p>
                                <div class="quote-nav">
                                    <button class="prev-quote">&lt;</button>
                                    <button class="next-quote">&gt;</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="oracle-card-wrapper">
                        <div class="oracle-card" id="wise-card">
                            <div class="oracle-front">
                                <div class="oracle-icon">🦉</div>
                                <h3>The Owl</h3>
                                <p>On Wisdom</p>
                            </div>
                            <div class="oracle-back">
                                <p class="quote-text"></p>
                                <p class="quote-author"></p>
                                <div class="quote-nav">
                                    <button class="prev-quote">&lt;</button>
                                    <button class="next-quote">&gt;</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="oracle-card-wrapper">
                        <div class="oracle-card" id="gita-card">
                            <div class="oracle-front">
                                <div class="oracle-icon">🕉</div>
                                <h3>The Way Of Living</h3>
                                <p>On Dharma</p>
                            </div>
                            <div class="oracle-back">
                                <p class="quote-text"></p>
                                <p class="quote-author"></p>
                                <div class="quote-nav">
                                    <button class="prev-quote">&lt;</button>
                                    <button class="next-quote">&gt;</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>


            <section id="wish-corner" class="card animate-on-scroll">
                <h2>Leave a Little Wish for Our Future</h2>
                <div id="wish-wall"></div>
                <form id="wish-form" action="https://formspree.io/f/mvgrlbaq" method="POST">
                    <input type="text" id="wish-input" name="wish" placeholder="e.g., Let's visit Japan together!" autocomplete="off" required>
                    <button type="submit">Add Wish ✨</button>
                </form>
                 <p id="form-status" style="text-align: center; margin-top: 15px;"></p>
            </section>
        </main>

        <footer id="main-footer">
            <p></p>
        </footer>
    </div>
    
    <div id="delete-zone">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></svg>
    </div>

    <div id="modal-container">
        <div id="modal-content">
            <span id="close-modal" title="Close">&times;</span>
            <img id="modal-image" src="" alt="Gallery Image">
            <p id="modal-caption"></p>
            <button id="modal-prev" title="Previous image">&lt;</button>
            <button id="modal-next" title="Next image">&gt;</button>
        </div>
    </div>

            <div id="game-overlay">

        <div id="game-ui" class="hidden-element">
            <div id="game-stats">
                <span>Score: <span id="game-score">0</span></span>
                <span>Time: <span id="game-timer">30</span>s</span>
                <span>High Score: <span id="game-high-score-ui">0</span></span>
            </div>
            <div id="game-controls">
                <button id="game-pause-btn" title="Pause">❚❚</button>
                <button id="game-quit-now-btn" title="Quit Game">X</button>
            </div>
        </div>

        <div id="game-main-menu">
            <h2>Game Menu</h2>
            <div class="menu-buttons">
                <button id="menu-start-game-btn" class="menu-btn">Start Game</button>
                <button id="menu-high-scores-btn" class="menu-btn">View High Scores</button>
                <button id="menu-history-btn" class="menu-btn">Game History</button>
                <button id="menu-close-btn" class="menu-btn secondary">Close</button>
            </div>
        </div>

        <div id="game-start-screen">
            <h2>Pop Balloon</h2>
            <p class="game-instructions">Pop the most amount of balloons in 30 seconds!</p>
            <div class="difficulty-buttons">
                <button id="difficulty-easy" class="difficulty-btn">Easy</button>
                <button id="difficulty-medium" class="difficulty-btn">Medium</button>
                <button id="difficulty-hard" class="difficulty-btn">Hard</button>
            </div>
             <button id="difficulty-back-btn" class="menu-btn secondary">Back</button>
        </div>

        <div id="game-high-scores-screen">
            <h2>High Scores</h2>
            <div id="high-scores-list">
                </div>
            <button id="high-scores-back-btn" class="menu-btn secondary">Back</button>
        </div>

        <div id="game-history-screen">
            <h2>Game History</h2>
            <div id="game-history-list">
                </div>
            <button id="history-back-btn" class="menu-btn secondary">Back</button>
        </div>

        <div id="game-pause-screen">
            <h2>Paused</h2>
            <button id="game-resume-btn">Resume</button>
        </div>

        <div id="game-end-screen">
            <h2>Game Over!</h2>
            <p>Final Score: <span id="final-score">0</span></p>
            <p>New High Score for <span id="new-high-score-mode"></span>!</p>
            <button id="game-restart-btn">Play Again</button>
            <button id="game-quit-btn">Back to Menu</button>
        </div>

        <div id="game-quit-confirm-screen">
            <h2>Quit Game?</h2>
            <p>Your Final Score: <span id="quit-confirm-score">0</span></p>
            <div class="game-controls-wrapper">
                <button id="quit-confirm-yes-btn">Yes, Quit</button>
                <button id="quit-confirm-no-btn">No, Go Back</button>
            </div>
        </div>

    </div>


    </div>

    <div id="pop-sounds" style="display: none;"></div>
    <audio id="celebration-audio" loop></audio>

    <audio id="audio-player" crossOrigin="anonymous"></audio>

    <div id="truth-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10002; backdrop-filter: blur(8px); background: rgba(26, 26, 46, 0.5); opacity: 0; pointer-events: none;">
        <canvas id="truth-text-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none;"></canvas>
        <div id="word-i" class="truth-word">I</div>
        <div id="word-lubhh" class="truth-word">Lubhh💞</div>
        <div id="word-booh" class="truth-word">Booh🫵🏼</div>
        <button id="truth-cancel-btn" style="display: none;">X</button>
    </div>
    <script>

// --- FORMSPREE CONFIGURATION ---
// =================================================================================
const FORMSPREE_MANAGER = {
    // ⬇️ PASTE YOUR FORMPSREE ENDPOINT URLS HERE ⬇️
    endpoints: [
        { 
            id: 'form_1', 
            url: 'https://formspree.io/f/mvgrlbaq', // Your primary endpoint
            manualOffset: 0 // Manually set submissions already used for this form
        },
        { 
            id: 'form_2', 
            url: 'https://formspree.io/f/your_secondary_endpoint_code', // Your second endpoint
            manualOffset: 0 
        },
        { 
            id: 'form_3', 
            url: 'https://formspree.io/f/your_tertiary_endpoint_code', // Your third endpoint
            manualOffset: 0 
        }
        // Add more endpoints here if needed
    ],

    // Switch to the next form when a form reaches this many submissions.
    // Set to 45 to be safe with the 50 submission limit.
    submissionLimit: 45,

    // --- Internal Logic (No need to edit below this line) ---
    storageKey: 'formspree_state',

    _getState: function() {
        try {
            const state = JSON.parse(localStorage.getItem(this.storageKey));
            const defaultState = { activeId: this.endpoints[0].id, counts: {} };
            // Ensure state is not malformed
            if (state && state.activeId && typeof state.counts === 'object') {
                return state;
            }
            return defaultState;
        } catch (e) {
            return { activeId: this.endpoints[0].id, counts: {} };
        }
    },

    _saveState: function(state) {
        localStorage.setItem(this.storageKey, JSON.stringify(state));
    },

    getCurrentEndpoint: function() {
        const state = this._getState();
        let activeEndpoint = this.endpoints.find(e => e.id === state.activeId);

        if (!activeEndpoint) { // Fallback if activeId is invalid
            activeEndpoint = this.endpoints[0];
            state.activeId = activeEndpoint.id;
            this._saveState(state);
        }

        const clientSideCount = state.counts[activeEndpoint.id] || 0;
        const totalCount = activeEndpoint.manualOffset + clientSideCount;

        if (totalCount >= this.submissionLimit) {
            // The current endpoint is full, find the next available one
            for (let i = 0; i < this.endpoints.length; i++) {
                const nextEndpoint = this.endpoints[i];
                const nextClientCount = state.counts[nextEndpoint.id] || 0;
                const nextTotalCount = nextEndpoint.manualOffset + nextClientCount;
                if (nextTotalCount < this.submissionLimit) {
                    state.activeId = nextEndpoint.id;
                    this._saveState(state);
                    return nextEndpoint; // Found a new endpoint
                }
            }
            // All endpoints are full
            return null; 
        }
        
        return activeEndpoint;
    },

    incrementCountForActive: function() {
        const state = this._getState();
        const activeId = state.activeId;
        if (!state.counts[activeId]) {
            state.counts[activeId] = 0;
        }
        state.counts[activeId]++;
        this._saveState(state);
    }
};
// =================================================================================


    document.addEventListener('DOMContentLoaded', () => {

        // =================================================================================
        // --- CONFIGURATION & DATA ---
        // =================================================================================
        const CONFIG = {
            herName: "SHREYA",
            yourName: "BITANU💞",
            birthday: { month: 7, day: 1, year: 2025, time: "00:00:00" },
            gameUnlockDate: { month: 7, day: 1, year: 2025, time: "00:00:00" }, // NEW: For the balloon game
            headerSubtitle: "To the one who illuminates my Universe...",
            message: {
                heading: "A Message From My Heart",
                body: "My dearest BELLU❣️, as we count down to your special day, I find myself reflecting on the incredible journey we've shared. You are the melody to my life's song, the color in my monochrome world. Every moment with you is a treasure I hold dear. You are not just my love, but my anchor, my inspiration, and my greatest adventure. I love you more than all the stars in the sky.",
                signature: "Forever and always,"
            },
            // NEW: Messages for the slider reveal
            sliderMessages: [
                "My Bellu,Loving you has been the most beautiful journey of my life — not just because of the laughter and the sweet moments, but because we’ve held on to each other through the storms too.","We’ve faced highs that made my heart soar, and lows that tested every part of us. Yet even in the hardest times, my faith in us has never wavered.","You’ve been my confidant, my safe place, my reason to keep going when things felt too heavy.","I want you to know that no matter what comes our way, I’m here. I’ll fight for us, for your happiness, and for the life we’re building together.","You’re my Bellu — the one who makes ordinary days glow, and who turns every challenge into something we can overcome side by side.","I love you more than words can say. And I’ll keep loving you, through it all.","Yours, always😇💞❤‍🔥❣️"
            ],
            // NEW: Configuration for the surprise section
            surprise: {
                unlockDelay: 10000, // 10 seconds after first slide
                countdown: 61200,// 5 seconds for reveal timer
                heading: "Something coming up...",
                subheading: "[chotu sa yet useful interesting sa surprise (I personally made for uhh)]",
                imageSrc: 'assets/images/surprise-image.jpg', // ❗IMPORTANT: You need to provide this image
                linkHref: 'https://www.example.com' // ❗IMPORTANT: You need to provide this link
            },
            journey: [
                { date: "Mid December, 2024", title: "Our First Hello👀😄", description: "The day our story began😂💞. I still remember the hell-heaven way we met😆.", image: "assets/images/journey1.jpg" },
                { date: "Feb 14, 2022", title: "The Plot Twist & the Rest is History😳", description: "We confessed regarding our feelings,you couldn't really believe you were actually in Love,mujhe confirm krna para thaa tumhe😂💞 Opposites do attract aur hum thehre Capricorn♑-Cancer♋        ~Complementary Opposites💪🏼😎❤‍🔥  _The Father & The Mother of Zodiacs😆❣️", image: "assets/images/journey2.jpg" },
                { date: "Jan-Feb, 2025", title: "Our Mutual Obsession❤‍🔥", description: "Remember those initial days we used to forget about what is subaah,what is raat🤣💕💕", image: "assets/images/journey3.jpg" },
                { date: "Jan-Present, 2025", title: "The Unwavering Love & Support Phase begins😇❤‍🔥", description: "Every Great relationship has its own charm in the inevitable Ups and Downs_And I am proud we made it all through despite your prior Fear of Love_We Met not by coincidence🕉", image: "assets/images/journey4.jpg" },
                                { date: "Present-Future", title:"The Commited Bond✊🏼💞❤‍🔥🕉",description:"We will support,love etc & all,eachother,    beyond eternity😌Hum already ekh dusre ko extend krna starr mr chuke hain_A lot to achieve in life_ekhsath kaafu kuch impactful bhi krenge in the long run_Last but not the least_I might have shown you what Genuine Love can actually look like in the real world but have it know_Love is in doing,and you have been unintentionally showing me,What it feels like to do so_Love You Yaarra🥰😊😌✌🏼💞", image: "assets/images/journey4.jpg" },
            ],
            gallery: [
                { src: "assets/images/photo1.jpg", alt: "Memory 1", caption: "That beautiful day at the beach." },
                { src: "assets/images/photo2.jpg", alt: "Memory 2", caption: "Our first anniversary celebration." },
                { src: "assets/images/photo3.png", alt: "Memory 3", caption: "Silly faces and endless laughter." },
                { src: "assets/images/photo4.jpg", alt: "Memory 4", caption: "Exploring the mountains together." },
                { src: "assets/images/photo5.png", alt: "Memory 5", caption: "A cozy evening at home." },
                { src: "assets/images/photo6.jpg", alt: "Memory 6", caption: "The day we brought our puppy home." }
            ],
            reasons: [
                "because of the way your eyes sparkle when you smile.",
                "for your infectious, wholehearted laugh.",
                "because you make me feel safe and cherished.",
                "for your incredible intelligence and sharp wit.",
                "because you challenge me to be a better person.",
                "for your unwavering kindness to everyone you meet.",
                "because you can make a gourmet meal out of anything.",
                "for the way you hum when you're concentrating.",
                "because you always know how to cheer me up.",
                "for your passion for the things you love.",
                "because you are my biggest supporter and fan.",
                "for your strength and resilience in tough times.",
                "because you have the most beautiful soul.",
                "for the way you look at me like I'm the only person in the world.",
                "because you make ordinary moments feel extraordinary.",
                "for our late-night talks about everything and nothing.",
                "because you are fiercely loyal to the people you love.",
                "for your adventurous spirit and love for exploring.",
                "because you have a cute little wrinkle on your nose when you're confused.",
                "for being my partner-in-crime and my best friend.",
                "because you see the good in everyone.",
                "for the way you dance when you think no one is watching.",
                "because you are patient and understanding.",
                "for your impeccable taste in movies and music.",
                "because you make me believe in myself.",
                "for your gentle touch that calms my soul.",
                "because you remember the little things.",
                "for your ambition and drive to achieve your dreams.",
                "because you are unapologetically yourself.",
                "for the comforting feeling of your hugs.",
                "because you are my calm in the middle of a storm.",
                "for your creativity and the beautiful things you create.",
                "for being the most honest person I know.",
                "because you make me laugh until my stomach hurts.",
                "for the way you care for animals and nature.",
                "because you are endlessly fascinating to me.",
                "for your ability to forgive and not hold grudges.",
                "because you are my favorite person to do nothing with.",
                "for the thoughtful advice you always give.",
                "because you are generous with your love and time.",
                "for the way you light up any room you enter.",
                "because you are my home.",
                "for your endless curiosity about the world.",
                "because you have the courage to stand up for what's right.",
                "for making me feel more alive than anyone else.",
                "for your adorable sleepy face in the morning.",
                "because you share your dreams and fears with me.",
                "for your optimistic outlook on life.",
                "for the way you can fix almost anything.",
                "because you are the missing piece to my puzzle.",
                "for being so wonderfully weird, just like me.",
                "because you listen, truly listen, when I talk.",
                "for your grace and elegance.",
                "because you are as beautiful on the inside as you are on the outside.",
                "for the memories we've already made and the ones to come.",
                "because you always give the best back scratches.",
                "for your dedication to your family and friends.",
                "because you are my sunshine on a cloudy day.",
                "for your incredible sense of direction (unlike me!).",
                "because you know my coffee order by heart.",
                "for the feeling of your hand in mine.",
                "because you are my greatest adventure.",
                "for your ability to make me see things from a new perspective.",
                "for your cute sneezes.",
                "because you're not afraid to be silly with me.",
                "for the way you care about my day.",
                "because every day with you is a gift.",
                "for your warmth that melts away my worries.",
                "because you have a heart of pure gold.",
                "for the little inside jokes we share.",
                "because you love me, flaws and all.",
                "for your confidence and how it inspires me.",
                "because you are my anchor in a wild sea.",
                "for the way you look when you're reading a book.",
                "because you make me feel understood without saying a word.",
                "for your incredible work ethic.",
                "because you make me feel like the luckiest person alive.",
                "for your smell, it feels like home.",
                "because you are my favorite travel companion.",
                "for the little notes you leave for me.",
                "because you are my inspiration.",
                "for the way you sing along to the radio, even when you don't know the words.",
                "because you make me a part of your future.",
                "for your thoughtful and meaningful gifts.",
                "because you never give up on me.",
                "because you are my person, forever and always.",
                "for being the calm, steady presence in my life.",
                "because you know how to make me a priority.",
                "for your incredible patience with my quirks.",
                "because your smile is the most beautiful thing I've ever seen.",
                "for your ability to find beauty in the simplest things.",
                "because life with you is never boring.",
                "for your protective nature over the ones you love.",
                "because you make me feel cherished and adored.",
                "for your endless capacity for love.",
                "because you are, quite simply, everything to me."
            ],
            playlist: [
                { title: "Perfect", artist: "Ed Sheeran", src: "assets/audio/song1.mp3", art: "assets/images/photo1.jpg" },
                { title: "A Thousand Years", artist: "Christina Perri", src: "assets/audio/song2.mp3", art: "assets/images/photo2.jpg" },
                { title: "All of Me", artist: "John Legend", src: "assets/audio/song3.mp3", art: "assets/images/photo3.png" }
            ],
            celebration: {
                song: "https://cdn.pixabay.com/audio/2022/08/04/audio_2911a06d50.mp3", 
                popSounds: [
                    "https://cdn.pixabay.com/audio/2021/08/04/audio_bb630cc098.mp3",
                    "https://cdn.pixabay.com/audio/2022/03/15/audio_73ed8c1a17.mp3",
                    "https://cdn.pixabay.com/audio/2021/08/04/audio_c3592a832a.mp3"
                ],
                nicknames: ["Cutu Putu", "Shreyuu", "Bellu", "Baby", "Babes", "Yaar", "Wifey", "Ghumlu", "My Love", "Sunshine"]
            },
            
            HEART_SPEED: { min: 0.4, max: 1.5 },

            footerText: "Crafted with LOVE ❤‍🔥, Code 👨🏻‍💻, and Countless Glasses of Water 🚰 for you 𝙎𝙃𝙍𝙀𝙔𝙐𝙐︎ 💞           ©2025"
        };




        // =================================================================================
        // --- APPLICATION LOGIC ---
        // =================================================================================
        
        window.App = {

            state: {
                isBirthday: false,
                isCelebrationActive: false,
                heartsVisible: true, 
                balloonsVisible: true, 
                wishes: [],
                heartParticles: [],
                balloonParticles: [], 


                gallery: { data: [], currentIndex: 0 },
                playlist: { 
                    data: [], 
                    currentIndex: 0, 
                    isPlaying: false, 
                    audioContext: null, 
                    analyser: null,
                    beatThreshold: 60,
                    lastBeatTime: 0 
                },
                countdownInterval: null,
                preloaderTimeline: null,
                reasonsPool: [],
                reasonClickCount: 0,
                popSoundPlayers: [],
                popSoundIndex: 0,
                // --- NEW: Game State ---
                game: {
                    isUnlockable: false,
                    isActive: false,
                    isPaused: false,
                    difficulty: 'easy',
                    score: 0,
                    timeLeft: 30,
                    gameInterval: null,
                    highScores: { easy: 0, medium: 0, hard: 0 }, 
                    gameHistory: [], 
                    balloonSpawnInterval: null
                },
                // --- NEW: Birthday feature states ---
                slider: {
                    currentMessageIndex: 0,
                    hasBeenUsedOnce: false,
                },
                surprise: {
                    isHintShown: false,
                    isSectionAdded: false,
                }
            },
            elements: {},
            
            init() {
                console.log("Initializing Special Day App...");
                gsap.registerPlugin(ScrollTrigger, TextPlugin);
                this.cacheDOMElements();
                this.checkIfBirthday();
                this.checkIfGameIsUnlockable(); 
                this.UI.init();
                this.Animations.initPreloader();
            },

            start() {
                this.populateTextContent();
                this.Content.setupDynamicContent();
                this.Content.loadWishesFromLocalStorage();
                //Uncommentthis//this.Content.setupGallery();
                this.Content.setupJourneyTimeline();
                this.Content.setupReasonsGenerator();
                this.Audio.setupMusicPlayer();
                this.UI.setupEventListeners();
                this.Animations.initMainPageAnimations();
                if (this.state.isBirthday) {
                    this.Celebration.start();
                    // NEW: Wait for initial confetti to finish before showing new features
                    setTimeout(() => {
                        this.UI.showBirthdayIntroPopup();
                        this.UI.setupMessageSlider();
                    }, 6000); // 6 seconds delay
                } else {
                    this.Content.startCountdown();
                }
            },

            cacheDOMElements() {
                this.elements = {
                    preloader: document.getElementById('preloader'),
                    loaderText: document.querySelector('.loader-text'),
                    loaderProgress: document.getElementById('loader-progress'),
                    preloaderHeart: document.getElementById('preloader-heart'),
                    ecgMask: document.getElementById('ecg-mask-rect'),
                    contentWrapper: document.getElementById('content-wrapper'),
                    mainHeading: document.getElementById('main-heading'),
                    headerSubtitle: document.getElementById('header-subtitle'),
                    dynamicSection: document.getElementById('dynamic-section'),
                    messageSection: document.getElementById('message'), // Target the whole section card
                    messageHeading: document.getElementById('message-heading'),
                    messageBody: document.getElementById('message-body'),
                    messageSignature: document.getElementById('message-signature'),
                    journeyContainer: document.querySelector('#journey .timeline'),
                    photoGrid: document.getElementById('photo-grid'),
                    reasonText: document.getElementById('reason-text'),
                    newReasonBtn: document.getElementById('new-reason-btn'),
                    playlistSection: document.getElementById('playlist'),
                    wishForm: document.getElementById('wish-form'),
                    wishInput: document.getElementById('wish-input'),
                    wishWall: document.getElementById('wish-wall'),
                    deleteZone: document.getElementById('delete-zone'),
                    formStatus: document.getElementById('form-status'),
                    mainFooter: document.querySelector('#main-footer p'),
                    modal: {
                        container: document.getElementById('modal-container'),
                        content: document.getElementById('modal-content'),
                        image: document.getElementById('modal-image'),
                        caption: document.getElementById('modal-caption'),
                        closeBtn: document.getElementById('close-modal'),
                        prevBtn: document.getElementById('modal-prev'),
                        nextBtn: document.getElementById('modal-next'),
                    },
                    audio: {
                        player: document.getElementById('audio-player'),
                        trackArt: document.getElementById('track-art'),
                        trackTitle: document.getElementById('track-title'),
                        trackArtist: document.getElementById('track-artist'),
                        playPauseBtn: document.getElementById('play-pause-btn'),
                        playPauseIcon: document.getElementById('play-pause-icon'),
                        prevBtn: document.getElementById('prev-btn'),
                        nextBtn: document.getElementById('next-btn'),
                        progressBar: document.getElementById('progress-bar'),
                        progressContainer: document.querySelector('.progress-container'),
                        visualizer: document.getElementById('audio-visualizer'),
                    },
                    celebration: {
                        playBtn: document.getElementById('celebration-play-btn'),
                        audioPlayer: document.getElementById('celebration-audio'),
                        popSoundsContainer: document.getElementById('pop-sounds')
                    },
                                        toggles: {
                        container: document.getElementById('view-toggles'),
                        heartsBtn: document.getElementById('toggle-hearts-btn'),
                        balloonsBtn: document.getElementById('toggle-balloons-btn'),
                    },

                    heartCanvas: document.getElementById('heart-canvas'),
                    balloonCanvas: document.getElementById('balloon-canvas'),
                    game: {
                        playBtn: document.getElementById('play-game-btn'),
                        overlay: document.getElementById('game-overlay'),
                        ui: document.getElementById('game-ui'),
                        score: document.getElementById('game-score'),
                        timer: document.getElementById('game-timer'),
                        highScoreUI: document.getElementById('game-high-score-ui'),
                        mainMenu: document.getElementById('game-main-menu'),
                        menuStartBtn: document.getElementById('menu-start-game-btn'),
                        menuHighScoresBtn: document.getElementById('menu-high-scores-btn'),
                        menuHistoryBtn: document.getElementById('menu-history-btn'),
                        menuCloseBtn: document.getElementById('menu-close-btn'),
                        startScreen: document.getElementById('game-start-screen'),
                        difficultyEasyBtn: document.getElementById('difficulty-easy'),
                        difficultyMediumBtn: document.getElementById('difficulty-medium'),
                        difficultyHardBtn: document.getElementById('difficulty-hard'),
                        difficultyBackBtn: document.getElementById('difficulty-back-btn'),
                        highScoresScreen: document.getElementById('game-high-scores-screen'),
                        highScoresList: document.getElementById('high-scores-list'),
                        highScoresBackBtn: document.getElementById('high-scores-back-btn'),
                        historyScreen: document.getElementById('game-history-screen'),
                        historyList: document.getElementById('game-history-list'),
                        historyBackBtn: document.getElementById('history-back-btn'),
                        pauseBtn: document.getElementById('game-pause-btn'),
                        resumeBtn: document.getElementById('game-resume-btn'),
                        quitNowBtn: document.getElementById('game-quit-now-btn'),
                        pauseScreen: document.getElementById('game-pause-screen'),
                        endScreen: document.getElementById('game-end-screen'),
                        finalScore: document.getElementById('final-score'),
                        newHighScoreMsg: document.querySelector('#game-end-screen p:nth-of-type(2)'),
                        newHighScoreMode: document.getElementById('new-high-score-mode'),
                        restartBtn: document.getElementById('game-restart-btn'),
                        quitBtn: document.getElementById('game-quit-btn'),
                        quitConfirmScreen: document.getElementById('game-quit-confirm-screen'),
                        quitConfirmScore: document.getElementById('quit-confirm-score'),
                        quitConfirmYesBtn: document.getElementById('quit-confirm-yes-btn'),
                        quitConfirmNoBtn: document.getElementById('quit-confirm-no-btn'),
                    }
                };
            },

            
            // --- REPLACE these two functions: checkIfBirthday, checkIfGameIsUnlockable ---
// --- WITH this new single function below ---

async fetchWorldTimeAndInitialize() {
    const loaderText = this.elements.loaderText;
    //loaderText.textContent = 'Syncing with universal time...';
    try {
        // Fetch the current universal time
        const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC');
        if (!response.ok) throw new Error(`Network response was not ok, status: ${response.status}`);
        const data = await response.json();
        const now = new Date(data.utc_datetime);

        // Get your target dates
        const { month: bMonth, day: bDay, year: bYear } = CONFIG.birthday;
        const birthdayDate = new Date(Date.UTC(bYear, bMonth - 1, bDay));

        const { month: gMonth, day: gDay, year: gYear } = CONFIG.gameUnlockDate;
        const gameDate = new Date(Date.UTC(gYear, gMonth - 1, gDay));

        // Compare and set state
        this.state.isBirthday = now.getTime() >= birthdayDate.getTime();
        this.state.game.isUnlockable = now.getTime() >= gameDate.getTime();

        console.log(`World Time Synced. Is it birthday? ${this.state.isBirthday}`);
        loaderText.textContent = 'Almost there...';

    } catch (error) {
        console.error("Failed to fetch world time, falling back to local time.", error);
        //loaderText.textContent = 'Could not sync time, using local clock...';
        // Fallback to original method in case of API failure
        const today = new Date();
        const { month, day, year } = CONFIG.birthday;
        const birthdayDate = new Date(year, month - 1, day);
        this.state.isBirthday = today.getTime() >= birthdayDate.getTime();
        const { month: gMonth, day: gDay, year: gYear } = CONFIG.gameUnlockDate;
        const gameDate = new Date(gYear, gMonth - 1, gDay);
        this.state.game.isUnlockable = today.getTime() >= gameDate.getTime();
    }
},

// --- MODIFY the existing App.init() function ---
// Replace the original init() with this async version

// Replace your existing App.init() function with this one
// Replace your existing App.init() function with this one
async init() {
    console.log("Initializing Special Day App...");
    // Register all plugins here, one time.
    gsap.registerPlugin(ScrollTrigger, TextPlugin, Draggable);
    
    this.cacheDOMElements();
    // This now waits for the time to be fetched before proceeding
    await this.fetchWorldTimeAndInitialize();
    this.UI.init();
    this.Animations.initPreloader();
},




            populateTextContent() {
                document.title = `A Special Day for ${CONFIG.herName}!`;
                this.elements.headerSubtitle.textContent = CONFIG.headerSubtitle;
                this.elements.messageHeading.textContent = CONFIG.message.heading;
                this.elements.messageBody.textContent = CONFIG.message.body;
                this.elements.messageSignature.textContent = `${CONFIG.message.signature}\n${CONFIG.yourName}`;
                this.elements.mainFooter.textContent = CONFIG.footerText;
            },

            
            UI: {
                init() {
                    this.initCustomCursor();
                    this.initHeartCanvas();
                    this.initBalloonCanvas();
                    this.initViewToggles();

                    if (App.state.isBirthday) {
                        App.Celebration.preloadPopSounds();
                    }
                    
                    
                },

          
                initViewToggles() {
                    const { heartsBtn, balloonsBtn } = App.elements.toggles;

                    heartsBtn.addEventListener('click', () => {
                        App.state.heartsVisible = !App.state.heartsVisible;
                        heartsBtn.classList.toggle('toggled-off', !App.state.heartsVisible);
                    });

                    balloonsBtn.addEventListener('click', () => {
                        App.state.balloonsVisible = !App.state.balloonsVisible;
                        balloonsBtn.classList.toggle('toggled-off', !App.state.balloonsVisible);
                    });

                },
                
                setupEventListeners() {
                    App.elements.modal.closeBtn.addEventListener('click', () => this.closeModal());
                    App.elements.modal.prevBtn.addEventListener('click', () => App.Content.showPrevImage());
                    App.elements.modal.nextBtn.addEventListener('click', () => App.Content.showNextImage());
                    App.elements.wishForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleWishSubmit(e);
                    });
                    App.elements.newReasonBtn.addEventListener('click', () => App.Content.generateNewReason());
                    App.elements.celebration.playBtn.addEventListener('click', () => App.Celebration.startMassCelebration(), { once: true });

                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && App.elements.modal.container.style.display === 'flex') {
                            this.closeModal();
                        }
                    });

                    document.addEventListener('click', (e) => {
                        if (e.target.closest('a, button, input, .photo-item, .timeline-content, .progress-container, .wish-bubble, .heart-particle, .balloon-particle, .message-slider-handle')) return;
                        const clickX = e.clientX;
                        const clickY = e.clientY;
                        if (App.UI.applyClickPush) {
                            App.UI.applyClickPush(clickX, clickY);
                        }
                        this.createClickBurst(clickX, clickY);
                    });

                    if (App.state.game.isUnlockable) {
                        const gameElements = App.elements.game;

                        gameElements.playBtn.addEventListener('click', () => App.Game.showMainMenu());
                        gameElements.menuStartBtn.addEventListener('click', () => App.Game.showDifficultySelector());
                        gameElements.menuHighScoresBtn.addEventListener('click', () => App.Game.showHighScores());
                        gameElements.menuHistoryBtn.addEventListener('click', () => App.Game.showHistory());
                        gameElements.menuCloseBtn.addEventListener('click', () => App.Game.closeOverlay());
                        gameElements.difficultyEasyBtn.addEventListener('click', () => App.Game.start('easy'));
                        gameElements.difficultyMediumBtn.addEventListener('click', () => App.Game.start('medium'));
                        gameElements.difficultyHardBtn.addEventListener('click', () => App.Game.start('hard'));
                        gameElements.difficultyBackBtn.addEventListener('click', () => App.Game.showMainMenu());
                        gameElements.highScoresBackBtn.addEventListener('click', () => App.Game.showMainMenu());
                        gameElements.historyBackBtn.addEventListener('click', () => App.Game.showMainMenu());
                        gameElements.pauseBtn.addEventListener('click', () => App.Game.pause());
                        gameElements.resumeBtn.addEventListener('click', () => App.Game.resume());
                        gameElements.restartBtn.addEventListener('click', () => App.Game.showDifficultySelector());
                        gameElements.quitBtn.addEventListener('click', () => App.Game.showMainMenu()); 
                        gameElements.quitNowBtn.addEventListener('click', () => App.Game.promptToQuit());
                        gameElements.quitConfirmYesBtn.addEventListener('click', () => App.Game.quit());
                        gameElements.quitConfirmNoBtn.addEventListener('click', () => App.Game.resume());
                    }
                },
                
                // --- NEW: Function for the first birthday popup ---
                showBirthdayIntroPopup() {
                    const popup = document.createElement('div');
                    popup.id = 'birthday-intro-popup';
                    popup.innerHTML = `
                        <div class="popup-content">
                            <p>The celebration has just begun...<br>Scroll down to uncover a message from my heart. 😉</p>
                        </div>
                    `;
                    document.body.appendChild(popup);
                    
                    const tl = gsap.timeline({
                        onComplete: () => {
                            // After animation, remove the popup
                            popup.remove();
                        }
                    });

                    tl.from(popup, { 
                        y: '100vh', 
                        opacity: 0,
                        duration: 1.5, 
                        ease: 'elastic.out(1, 0.5)' 
                    })
                    .to(popup, { 
                        delay: 3, // Keep it on screen for 3 seconds
                        y: '100vh',
                        opacity: 0,
                        duration: 1, 
                        ease: 'power2.in'
                    });
                },

                // --- NEW: Function to set up the message slider ---
                // At the top of your main script, right after the other GSAP registrations


// ... inside the App object ...
// ... inside the App.UI object ...

// ⬇️ REPLACE the entire setupMessageSlider function with this ⬇️
setupMessageSlider() {
    const messageSection = App.elements.messageSection;
    if (!messageSection) return;

    // Create and inject the new HTML structure for the slider
    const sliderHTML = `
        <div class="message-slider-container">
            <div class="message-slider-track">
                <div class="message-slider-progress" id="message-slider-progress"></div>
                <div class="message-slider-handle" id="message-slider-handle">💌</div>
            </div>
            <span class="slider-prompt">Slide me to reveal a secret message...</span>
        </div>
    `;
    messageSection.insertAdjacentHTML('beforeend', sliderHTML);

    const handle = document.getElementById('message-slider-handle');
    const track = handle.parentElement;
    const progressFill = document.getElementById('message-slider-progress');
    const prompt = document.querySelector('.slider-prompt');

    // Use GSAP's Draggable for smooth, interactive control
    Draggable.create(handle, {
        type: "x",
        bounds: track,
        inertia: true, // Gives it a nice "throw" effect
        onPress: function() {
            handle.classList.add('dragging');
            gsap.to(prompt, { opacity: 0, duration: 0.3 }); // Fade out prompt on drag
        },
        onDrag: function() {
            // Update the progress bar fill
            const progress = this.x / (this.maxX - this.minX);
            gsap.set(progressFill, { width: `${progress * 100}%` });

            // Rotate the card based on drag position
            gsap.to(messageSection, {
                rotationY: progress * 360,
                transformOrigin: "center center",
                ease: 'power1.out'
            });
        },
        onRelease: function() {
            handle.classList.remove('dragging');
            // Check if the slider is dragged past the 95% mark
            if (this.x >= this.maxX * 0.95) {
                // Animate to the end and trigger completion
                gsap.to(this.target, {
                    x: this.maxX,
                    duration: 0.3,
                    ease: 'power2.out',
                    onComplete: handleSlideComplete
                });
            } else {
                // Snap back to the beginning
                gsap.to(this.target, {
                    x: this.minX,
                    duration: 0.8,
                    ease: 'elastic.out(1, 0.4)'
                });
                gsap.to(progressFill, { width: '0%', duration: 0.8, ease: 'elastic.out(1, 0.4)' });
                gsap.to(messageSection, { rotationY: 0, duration: 1, ease: 'elastic.out(1, 0.4)' });
                gsap.to(prompt, { opacity: 1, duration: 0.3, delay: 0.5 }); // Fade prompt back in
            }
        }
    });

    function handleSlideComplete() {
        // Increment message index
        App.state.slider.currentMessageIndex = (App.state.slider.currentMessageIndex + 1) % CONFIG.sliderMessages.length;
        const newMessage = CONFIG.sliderMessages[App.state.slider.currentMessageIndex];

        const messageBody = App.elements.messageBody;
        const messageSignature = App.elements.messageSignature;
        const isFinalMessage = App.state.slider.currentMessageIndex === CONFIG.sliderMessages.length - 1;

        // Animate out the old text
        gsap.to([messageBody, messageSignature], {
            opacity: 0,
            y: -20,
            duration: 0.4,
            ease: 'power2.in',
            onComplete: () => {
                // Update the text content
                messageBody.textContent = newMessage;
                messageSignature.textContent = isFinalMessage ? `Yours, forever and always,\n${CONFIG.yourName}` : "";

                // Animate in the new text
                gsap.to([messageBody, messageSignature], { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' });

                // Reset slider and card after a delay
                setTimeout(resetSlider, 800);
            }
        });

        // Trigger the surprise popup hint after the first successful slide
        if (!App.state.slider.hasBeenUsedOnce) {
            App.state.slider.hasBeenUsedOnce = true;
            setTimeout(() => {
                App.UI.showSurpriseHintPopup();
            }, CONFIG.surprise.unlockDelay);
        }
    }

    function resetSlider() {
        // Reset handle, progress, and card rotation with a flourish
        gsap.to(handle, { x: 0, duration: 0.8, ease: 'elastic.out(1, 0.5)' });
        gsap.to(progressFill, { width: '0%', duration: 0.8, ease: 'elastic.out(1, 0.5)' });
        gsap.to(messageSection, { rotationY: 0, duration: 1.2, ease: 'elastic.out(1, 0.5)' });
        
        // Update prompt text for subsequent slides
        prompt.textContent = isNaN(App.state.slider.currentMessageIndex) || App.state.slider.currentMessageIndex === CONFIG.sliderMessages.length - 1
            ? 'Slide me again to restart the messages...'
            : 'Slide me for the next secret...';
        gsap.to(prompt, { opacity: 1, duration: 0.5, delay: 0.8 });
    }
},

                
                // --- NEW: Function for the surprise hint popup ---
                showSurpriseHintPopup() {
                    if (App.state.surprise.isHintShown) return;
                    App.state.surprise.isHintShown = true;
                    
                    const popup = document.createElement('div');
                    popup.id = 'surprise-hint-popup';
                    popup.innerHTML = `<div class="popup-content">🤫 Psst... A little surprise has appeared somewhere over here🤫!</div>`;
                    document.body.appendChild(popup);

                    if (!App.state.surprise.isSectionAdded) {
                        App.Content.addSurpriseSection();
                    }

                    const tl = gsap.timeline({
                        onComplete: () => popup.remove()
                    });

                    tl.from(popup, { opacity: 0, y: 50, duration: 0.5, ease: 'back.out(1.7)' })
                      .to(popup, { 
                          delay: 3, 
                          y: '-100vh', 
                          opacity: 0,
                          duration: 1, 
                          ease: 'power2.in' 
                      });
                },


                initCustomCursor() {
                    const cursor = document.getElementById('custom-cursor');
                    if (window.matchMedia("(pointer: fine)").matches) {
                        window.addEventListener('mousemove', e => {
                            gsap.to(cursor, { x: e.clientX, y: e.clientY, duration: 0.2, ease: 'power2.out' });
                        });
                        document.querySelectorAll('a, button, .photo-item, .timeline-content, .progress-container, input, .wish-bubble, .balloon-particle').forEach(el => {
                            el.addEventListener('mouseenter', () => cursor.classList.add('expand'));
                            el.addEventListener('mouseleave', () => cursor.classList.remove('expand'));
                        });
                    } else {
                        cursor.style.display = 'none';
                    }
                },

                initHeartCanvas() {
                    const canvas = App.elements.heartCanvas;
                    if (!canvas) return;
                    const ctx = canvas.getContext('2d');
                    const heartParticles = App.state.heartParticles;

                    const heartColors = ['#ff4081', '#ff80ab', '#f50057', '#e91e63', '#d81b60', '#ad1457', '#ff5252', '#ff1744'];

                    function resizeCanvas() {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    }
                    window.addEventListener('resize', resizeCanvas);
                    resizeCanvas();

                    function drawHeart(ctx, x, y, size, rotation, color, opacity, scale = 1) {
                        ctx.save();
                        ctx.translate(x, y);
                        ctx.rotate(rotation);
                        ctx.scale(scale, scale);
                        ctx.fillStyle = color;
                        ctx.globalAlpha = opacity;
                        ctx.shadowBlur = 15;
                        ctx.shadowColor = color;
                        
                        ctx.beginPath();
                        const topCurveHeight = size * 0.3;
                        ctx.moveTo(0, topCurveHeight);
                        ctx.bezierCurveTo(0, 0, -size / 2, 0, -size / 2, topCurveHeight);
                        ctx.bezierCurveTo(-size / 2, size * 0.7, 0, size * 0.7, 0, size);
                        ctx.bezierCurveTo(0, size * 0.7, size / 2, size * 0.7, size / 2, topCurveHeight);
                        ctx.bezierCurveTo(size / 2, 0, 0, 0, 0, topCurveHeight);
                        ctx.closePath();
                        ctx.fill();
                        ctx.restore();
                    }

                    function createParticle(options = {}) {
                        const isBurst = options.isBurst || false;
                        const size = options.size || Math.random() * 25 + 20;

                        if (isBurst) {
                            return {
                                x: options.x,
                                y: options.y,
                                size: size,
                                isBurst: true,
                                opacity: 1,
                                color: options.color || heartColors[Math.floor(Math.random() * heartColors.length)],
                                vx: gsap.utils.random(-4, 4),
                                vy: gsap.utils.random(-4, 4),
                                vr: gsap.utils.random(-0.05, 0.05),
                                lifespan: gsap.utils.random(50, 80),
                                sway: 0, swaySpeed: 0, swayAmount: 0,
                                scale: 1, initialScale: 1, targetScale: 1, scaleProgress: 0,
                            };
                        }

                        const mainSpeed = gsap.utils.random(CONFIG.HEART_SPEED.min, CONFIG.HEART_SPEED.max);
                        const driftSpeed = mainSpeed * 0.4; 
                        let x, y, vx, vy;
                        const side = Math.floor(Math.random() * 4); 

                        switch (side) {
                            case 0: 
                                x = Math.random() * canvas.width; y = -size;
                                vx = gsap.utils.random(-driftSpeed, driftSpeed); vy = mainSpeed;
                                break;
                            case 1:
                                x = canvas.width + size; y = Math.random() * canvas.height;
                                vx = -mainSpeed; vy = gsap.utils.random(-driftSpeed, driftSpeed);
                                break;
                            case 2:
                                x = Math.random() * canvas.width; y = canvas.height + size;
                                vx = gsap.utils.random(-driftSpeed, driftSpeed); vy = -mainSpeed;
                                break;
                            case 3:
                                x = -size; y = Math.random() * canvas.height;
                                vx = mainSpeed; vy = gsap.utils.random(-driftSpeed, driftSpeed);
                                break;
                        }

                        return {
                            x, y, vx, vy, size, isBurst: false, lifespan: Infinity,
                            scale: 1, initialScale: 1, targetScale: 1, scaleProgress: 0,
                            rotation: Math.random() * Math.PI * 2,
                            opacity: Math.random() * 0.6 + 0.3,
                            color: heartColors[Math.floor(Math.random() * heartColors.length)],
                            vr: gsap.utils.random(-0.02, 0.02),
                            sway: Math.random() * Math.PI * 2,
                            swaySpeed: Math.random() * 0.02,
                            swayAmount: Math.random() * 0.8
                        };
                    }

                    for (let i = 0; i < 60; i++) {
                        heartParticles.push(createParticle());
                    }
                    
                    this.addBurstParticles = (x, y) => {
                        for (let i = 0; i < 7; i++) {
                            heartParticles.push(createParticle({
                                x: x, y: y, isBurst: true, size: Math.random() * 10 + 5
                            }));
                        }
                    };

                    this.applyClickPush = (clickX, clickY) => {
                        const pushRadius = 150, pushStrength = 5;
                        heartParticles.forEach(p => {
                            if (p.isBurst) return; 
                            const dx = p.x - clickX, dy = p.y - clickY;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            if (distance < pushRadius) {
                                const angle = Math.atan2(dy, dx);
                                const force = (1 - (distance / pushRadius)) * pushStrength;
                                p.vx += Math.cos(angle) * force;
                                p.vy += Math.sin(angle) * force;
                            }
                        });
                    };

                    function animate() {
                        requestAnimationFrame(animate);
                        if (!App.state.heartsVisible) {
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            return;
                        }
                        ctx.clearRect(0, 0, canvas.width, canvas.height);

                        for (let i = heartParticles.length - 1; i >= 0; i--) {
                            const p = heartParticles[i];
                            
                            p.sway += p.swaySpeed;
                            p.x += p.vx + Math.sin(p.sway) * p.swayAmount;
                            p.y += p.vy;
                            p.rotation += p.vr;

                            if (p.isBurst) {
                                p.vx *= 0.98;
                                p.vy *= 0.98;
                            }
                            
                            if (p.scale !== p.targetScale) {
                                p.scaleProgress = Math.min(1, p.scaleProgress + 0.05);
                                p.scale = gsap.utils.interpolate(p.initialScale, p.targetScale, p.scaleProgress);
                                if (p.scaleProgress >= 1) {
                                    p.scale = p.targetScale; p.targetScale = 1; p.initialScale = p.scale; p.scaleProgress = 0;
                                }
                            }
                            
                            drawHeart(ctx, p.x, p.y, p.size, p.rotation, p.color, p.opacity, p.scale);

                            if (p.isBurst) {
                                p.lifespan--;
                                p.opacity -= 1 / p.lifespan;
                                if (p.lifespan <= 0 || p.opacity <= 0) {
                                    heartParticles.splice(i, 1);
                                    continue;
                                }
                            } else if (p.y < -p.size || p.y > canvas.height + p.size || p.x < -p.size || p.x > canvas.width + p.size) {
                                heartParticles.splice(i, 1);
                                heartParticles.push(createParticle());
                            }
                        }
                    }
                    animate();
                },

                                initBalloonCanvas() {
                    const canvas = App.elements.balloonCanvas;
                    if (!canvas) return;
                    const ctx = canvas.getContext('2d');
                    const balloonParticles = App.state.balloonParticles;

                    const colors = {
                        red: '#ff5252', blue: '#448aff', green: '#69f0ae',
                        yellow: '#ffd600', purple: '#e040fb', orange: '#ffab40'
                    };
                    const colorNames = Object.keys(colors);

                    function resizeCanvas() {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    }
                    window.addEventListener('resize', resizeCanvas);
                    resizeCanvas();

                    function drawBalloon(p) {
                        ctx.save();
                        ctx.translate(p.x, p.y);
                        
                        ctx.beginPath();
                        ctx.fillStyle = p.color;
                        ctx.ellipse(0, 0, p.width / 2, p.height / 2, p.rotation, 0, 2 * Math.PI);
                        ctx.fill();

                        const shineGrad = ctx.createRadialGradient(-p.width * 0.15, -p.height * 0.2, p.width * 0.05, 0, 0, p.width * 0.7);
                        shineGrad.addColorStop(0, 'rgba(255, 255, 255, 0.7)');
                        shineGrad.addColorStop(1, 'rgba(255, 255, 255, 0)');
                        ctx.fillStyle = shineGrad;
                        ctx.fill();

                        ctx.beginPath();
                        ctx.moveTo(-p.width * 0.1, p.height / 2);
                        ctx.lineTo(p.width * 0.1, p.height / 2);
                        ctx.lineTo(0, p.height / 2 + p.width * 0.15);
                        ctx.closePath();
                        ctx.fillStyle = p.color;
                        ctx.filter = 'brightness(0.8)';
                        ctx.fill();
                        ctx.filter = 'none';

                        if (p.text) {
                            ctx.font = `${p.width / 4}px 'Comic Neue', cursive`;
                            ctx.fillStyle = 'rgba(26, 26, 46, 0.7)';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.rotate(-15 * Math.PI / 180); 
                            ctx.fillText(p.text, 0, 0);
                        }
                        
                        ctx.restore();
                    }

                    function createParticle() {
                        const size = gsap.utils.random(80, 120);
                        const colorName = colorNames[Math.floor(Math.random() * colorNames.length)];
                        
                        return {
                            x: gsap.utils.random(size, canvas.width - size),
                            y: canvas.height + size * 1.5,
                            width: size,
                            height: size * 1.25,
                            rotation: 0,
                            color: colors[colorName],
                            text: CONFIG.celebration.nicknames[Math.floor(Math.random() * CONFIG.celebration.nicknames.length)],
                            vx: 0,
                            vy: gsap.utils.random(-1, -2.5),
                            sway: Math.random() * Math.PI * 2,
                            swaySpeed: Math.random() * 0.01 + 0.005,
                            swayAmount: Math.random() * 20 + 10,
                            popped: false
                        };
                    }

                    this.addCelebrationBalloon = () => {
                        if (App.state.balloonsVisible) {
                            balloonParticles.push(createParticle());
                        }
                    };
                    
                    canvas.addEventListener('click', (e) => {
                         // --- MODIFICATION IS HERE ---
                         // This check now prevents clicks from registering if balloons are toggled off.
                         if (!App.state.isCelebrationActive || App.state.game.isActive || !App.state.balloonsVisible) return;

                        const rect = canvas.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const clickY = e.clientY - rect.top;

                        for (let i = balloonParticles.length - 1; i >= 0; i--) {
                            const p = balloonParticles[i];
                            const dx = p.x - clickX;
                            const dy = p.y - clickY;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < p.width / 2) {
                                p.popped = true;
                                App.Celebration.handleBalloonPop({ x: p.x, y: p.y });
                                break; 
                            }
                        }
                    });

                    function animate() {
                        requestAnimationFrame(animate);

                        if (!App.state.balloonsVisible) {
                             ctx.clearRect(0, 0, canvas.width, canvas.height);
                             return;
                        }

                        ctx.clearRect(0, 0, canvas.width, canvas.height);

                        for (let i = balloonParticles.length - 1; i >= 0; i--) {
                            const p = balloonParticles[i];

                            if (p.popped) {
                                balloonParticles.splice(i, 1);
                                continue;
                            }

                            p.sway += p.swaySpeed;
                            p.x += Math.sin(p.sway) * 0.5;
                            p.y += p.vy;
                            p.rotation = Math.sin(p.sway) * (10 * Math.PI / 180);

                            drawBalloon(p);
                            
                            if (p.y < -p.height) {
                                balloonParticles.splice(i, 1);
                            }
                        }
                    }
                    animate();
                },


                animateHeartFloat(heart) {
                    const duration = Math.random() * 15 + 20;
                    gsap.to(heart, { y: '-10vh', rotation: 'random(-360, 360)', duration: duration, ease: 'none', onComplete: () => { this.recycleHeart(heart); } });
                },

                recycleHeart(heart) {
                    gsap.killTweensOf(heart, "x,rotation");
                    const size = Math.random() * 30 + 15;
                    gsap.set(heart, { x: `${Math.random() * 100}vw`, y: `${gsap.utils.random(100, 105)}vh`, opacity: Math.random() * 0.5 + 0.3, rotation: 0, width: size, height: size });
                    this.animateHeartFloat(heart);
                    gsap.to(heart, { scale: 1.2, duration: Math.random() * 1 + 1.5, repeat: -1, yoyo: true, ease: 'sine.inOut', delay: Math.random() * 2 });
                },

                createClickBurst(x, y) {
                    if (this.addBurstParticles) {
                        this.addBurstParticles(x, y);
                    }
                },

                openModal(index) {
                    App.state.gallery.currentIndex = index;
                    this.updateModalContent();
                    App.elements.modal.container.style.display = 'flex';
                    gsap.from(App.elements.modal.content, { scale: 0.8, opacity: 0, duration: 0.4, ease: 'back.out(1.7)' });
                },

                closeModal() {
                    gsap.to(App.elements.modal.content, { scale: 0.8, opacity: 0, duration: 0.3, ease: 'power2.in', onComplete: () => { App.elements.modal.container.style.display = 'none'; }});
                },

                updateModalContent() {
                    const photo = App.state.gallery.data[App.state.gallery.currentIndex];
                    const img = App.elements.modal.image;
                    const caption = App.elements.modal.caption;
                    gsap.to([img, caption], { opacity: 0, duration: 0.2, onComplete: () => { img.src = photo.src; caption.textContent = photo.caption; gsap.to([img, caption], { opacity: 1, duration: 0.3 }); } });
                },

                handleWishSubmit(event) {
                    const form = event.target;
                    const data = new FormData(form);
                    const wishText = App.elements.wishInput.value.trim();
                    const statusEl = App.elements.formStatus;
                    const buttonEl = form.querySelector('button');

                    if (!wishText) return;

                    buttonEl.disabled = true;
                    statusEl.textContent = 'Sending...';
                    statusEl.style.color = 'var(--accent-color)';

                    const activeEndpoint = FORMSPREE_MANAGER.getCurrentEndpoint();

                    if (!activeEndpoint) {
                        statusEl.textContent = "So many wishes! Please try again later. ❤️";
                        statusEl.style.color = 'var(--heart-color)';
                        buttonEl.disabled = false;
                        return;
                    }

                    form.action = activeEndpoint.url;

                    fetch(form.action, {
                        method: 'POST',
                        body: data,
                        headers: { 'Accept': 'application/json' }
                    }).then(response => {
                        if (response.ok) {
                            statusEl.textContent = "Ouhh I see👀Thanks for the wish! ❤️";
                            statusEl.style.color = '#4CAF50';
                            FORMSPREE_MANAGER.incrementCountForActive();
                            const newWish = { id: Date.now(), text: wishText };
                            App.state.wishes.push(newWish);
                            App.Content.saveWishesToLocalStorage();
                            this.createWishBubble(newWish.text, newWish.id);
                            form.reset();
                        } else {
                            statusEl.textContent = "Oops! There was a problem sending your wish.";
                            statusEl.style.color = 'var(--heart-color)';
                        }
                    }).catch(error => {
                        statusEl.textContent = "Oops! There was a network problem.";
                        statusEl.style.color = 'var(--heart-color)';
                    }).finally(() => {
                        buttonEl.disabled = false;
                        setTimeout(() => { statusEl.textContent = '' }, 5000);
                    });
                },

                createWishBubble(text, id) {
                    const bubble = document.createElement('div');
                    bubble.classList.add('wish-bubble');
                    bubble.textContent = text;
                    bubble.dataset.id = id;

                    App.elements.wishWall.appendChild(bubble);
                    gsap.from(bubble, { scale: 0.5, opacity: 0, duration: 0.5, ease: 'back.out(1.7)' });
                    
                    this.addDragToDeleteListeners(bubble);
                },
                
                addDragToDeleteListeners(element) {
                    let longPressTimer;
                    let isDragging = false;
                    let clone = null;
                    const deleteZone = App.elements.deleteZone;

                    const onPointerDown = (e) => {
                        longPressTimer = setTimeout(() => {
                            isDragging = true;
                            clone = element.cloneNode(true);
                            clone.classList.add('wish-bubble-clone');
                            document.body.appendChild(clone);
                            
                            const startX = e.clientX || e.touches[0].clientX;
                            const startY = e.clientY || e.touches[0].clientY;
                            gsap.set(clone, { left: startX, top: startY });

                            element.classList.add('is-dragging');
                            deleteZone.classList.add('visible');
                            
                            if (navigator.vibrate) navigator.vibrate(50);
                        }, 500);

                        window.addEventListener('pointermove', onPointerMove);
                        window.addEventListener('pointerup', onPointerUp);
                    };

                    const onPointerMove = (e) => {
                        if (isDragging && clone) {
                            const moveX = e.clientX || e.touches[0].clientX;
                            const moveY = e.clientY || e.touches[0].clientY;
                            gsap.to(clone, { left: moveX, top: moveY, duration: 0.1 });
                            
                            const deleteRect = deleteZone.getBoundingClientRect();
                            if (moveX > deleteRect.left && moveX < deleteRect.right &&
                                moveY > deleteRect.top && moveY < deleteRect.bottom) {
                                deleteZone.classList.add('over');
                            } else {
                                deleteZone.classList.remove('over');
                            }
                        }
                    };

                    const onPointerUp = (e) => {
                        clearTimeout(longPressTimer);
                        if (isDragging && clone) {
                            const idToDelete = Number(element.dataset.id);
                            
                            if (deleteZone.classList.contains('over')) {
                                const wishIndex = App.state.wishes.findIndex(w => w.id === idToDelete);
                                if (wishIndex > -1) {
                                    const [deletedWish] = App.state.wishes.splice(wishIndex, 1);
                                    App.Content.saveWishesToLocalStorage();
                                    this.notifyOfDeletion(deletedWish.text);
                                }
                                gsap.to(element, { scale: 0, opacity: 0, duration: 0.3, onComplete: () => element.remove() });
                            } else {
                                element.classList.remove('is-dragging');
                            }
                            clone.remove();
                            deleteZone.classList.remove('visible', 'over');
                        }
                        isDragging = false;
                        window.removeEventListener('pointermove', onPointerMove);
                        window.removeEventListener('pointerup', onPointerUp);
                    };

                    element.addEventListener('pointerdown', onPointerDown);
                },
                
                notifyOfDeletion(wishText) {
                    const activeEndpoint = FORMSPREE_MANAGER.getCurrentEndpoint();
                    if (!activeEndpoint) {
                        console.error("Could not send deletion notification: all Formspree endpoints are full.");
                        return;
                    }

                    const formData = new FormData();
                    formData.append('_subject', `A wish was deleted!`);
                    formData.append('message', `The following wish was deleted from the page by a user: "${wishText}"`);

                    fetch(activeEndpoint.url, {
                        method: 'POST',
                        body: formData,
                        headers: { 'Accept': 'application/json' }
                    }).catch(err => console.error('Could not notify of deletion.', err));
                }

            },

            Content: {
                loadWishesFromLocalStorage() {
                    const savedWishes = localStorage.getItem('userWishes');
                    if (savedWishes) {
                        App.state.wishes = JSON.parse(savedWishes);
                        App.state.wishes.forEach(wish => {
                            App.UI.createWishBubble(wish.text, wish.id);
                        });
                    }
                },
                
                saveWishesToLocalStorage() {
                    localStorage.setItem('userWishes', JSON.stringify(App.state.wishes));
                },

                setupDynamicContent() {
                    if (App.state.isBirthday) {
                        App.elements.mainHeading.textContent = `Happy 18th Birthday, My Dearest ${CONFIG.herName}!`;
                        App.elements.dynamicSection.innerHTML = `<div id="birthday-message"><h2>Today is YOUR day!</h2><p style="text-align:center; font-size:1.2em;">Wishing you all the happiness in the universe. Let's celebrate! Balle balleeh yaayyy 🥳🎉</p></div>`;
                    } else {
                        App.elements.mainHeading.textContent = `Happy Birthday in Advance My Dearest Wifey~Devi Ji ;)`;
                        App.elements.dynamicSection.innerHTML = `<h2>Countdown to Your Special Day</h2><div id="countdown"><div><span id="days" class="value">00</span><span class="label">Days</span></div><div><span id="hours" class="value">00</span><span class="label">Hours</span></div><div><span id="minutes" class="value">00</span><span class="label">Minutes</span></div><div><span id="seconds" class="value">00</span><span class="label">Seconds</span></div><div><span id="milliseconds" class="value">000</span><span class="label">Milliseconds</span></div></div>`;
                    }
                },

                startCountdown() {
                    if (App.state.isBirthday) return;
                    const { month, day, year, time } = CONFIG.birthday;
                    const countDate = new Date(`${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${time}`).getTime();
                    const els = {
                        days: document.getElementById('days'),
                        hours: document.getElementById('hours'),
                        minutes: document.getElementById('minutes'),
                        seconds: document.getElementById('seconds'),
                        milliseconds: document.getElementById('milliseconds')
                    };
                    if (!els.days) return;
                    function update() {
                        const now = new Date().getTime();
                        const gap = countDate - now;
                        if (gap <= 0) {
                            cancelAnimationFrame(App.state.countdownInterval);
                            location.reload();
                            return;
                        }
                        els.days.innerText = Math.floor(gap / 86400000).toString().padStart(2, '0');
                        els.hours.innerText = Math.floor((gap % 86400000) / 3600000).toString().padStart(2, '0');
                        els.minutes.innerText = Math.floor((gap % 3600000) / 60000).toString().padStart(2, '0');
                        els.seconds.innerText = Math.floor((gap % 60000) / 1000).toString().padStart(2, '0');
                        els.milliseconds.innerText = (gap % 1000).toString().padStart(3, '0');
                        App.state.countdownInterval = requestAnimationFrame(update);
                    }
                    update();
                },

                setupGallery() {
                    App.state.gallery.data = CONFIG.gallery;
                    const grid = App.elements.photoGrid;
                    grid.innerHTML = '';
                    CONFIG.gallery.forEach((photo, index) => {
                        const item = document.createElement('div');
                        item.className = 'photo-item';
                        const img = document.createElement('img');
                        img.src = photo.src; img.alt = photo.alt; img.dataset.index = index;
                        item.appendChild(img);
                        item.addEventListener('click', () => App.UI.openModal(index));
                        grid.appendChild(item);
                    });
                },

                showPrevImage() {
                    const len = App.state.gallery.data.length;
                    App.state.gallery.currentIndex = (App.state.gallery.currentIndex - 1 + len) % len;
                    App.UI.updateModalContent();
                },

                showNextImage() {
                    const len = App.state.gallery.data.length;
                    App.state.gallery.currentIndex = (App.state.gallery.currentIndex + 1) % len;
                    App.UI.updateModalContent();
                },

                setupJourneyTimeline() {
                    const container = App.elements.journeyContainer;
                    container.innerHTML = '';
                    CONFIG.journey.forEach(item => {
                        const timelineItem = document.createElement('div');
                        timelineItem.className = 'timeline-item';
                        const content = document.createElement('div');
                        content.className = 'timeline-content';
                        content.innerHTML = `<span class="date">${item.date}</span><h3>${item.title}</h3><p>${item.description}</p>`;
                        const imageIndexInGallery = CONFIG.gallery.findIndex(p => p.src === item.image);
                        if (imageIndexInGallery !== -1) {
                            content.style.cursor = 'pointer';
                            content.addEventListener('click', () => App.UI.openModal(imageIndexInGallery));
                        }
                        timelineItem.appendChild(content);
                        container.appendChild(timelineItem);
                    });
                },

                setupReasonsGenerator() {
                    App.state.reasonsPool = [...CONFIG.reasons];
                    App.state.reasonsPool.sort(() => Math.random() - 0.5);
                    App.state.reasonClickCount = 0;
                },

                generateNewReason() {
                    const btn = App.elements.newReasonBtn;
                    const textEl = App.elements.reasonText;
                    const cooldownDuration = 2.5;
                    const bubbleCount = 20;

                    if (btn.disabled) return;

                    App.state.reasonClickCount++;
                    if (App.state.reasonClickCount === 5) {
                        this.triggerTheTruth();
                        return;
                    }
                    if (App.state.reasonsPool.length === 0) {
                        App.state.reasonsPool = [...CONFIG.reasons];
                        App.state.reasonsPool.sort(() => Math.random() - 0.5);
                    }
                    const reason = App.state.reasonsPool.pop();
                    gsap.to(textEl, {
                        opacity: 0,
                        y: -20,
                        duration: 0.3,
                        ease: 'power2.in',
                        onComplete: () => {
                            textEl.textContent = `...${reason}`;
                            gsap.to(textEl, { opacity: 1, y: 0, duration: 0.4, ease: 'power2.out' });
                        }
                    });

                    btn.disabled = true;
                    const btnRect = btn.getBoundingClientRect();
                    const bubbles = [];

                    gsap.to(btn, { backgroundColor: '#0f3460', duration: 0.3 });

                    for (let i = 0; i < bubbleCount; i++) {
                        const bubble = document.createElement('div');
                        bubble.className = 'cooldown-blob';
                        btn.appendChild(bubble);
                        bubbles.push(bubble);
                    }

                    const tl = gsap.timeline({
                        onComplete: () => {
                            btn.disabled = false;
                            bubbles.forEach(bubble => bubble.remove());
                            gsap.to(btn, { backgroundColor: 'var(--accent-color)', duration: 0.5 });
                        }
                    });

                    tl.to(bubbles, {
                        y: () => -btnRect.height - 50,
                        scale: () => gsap.utils.random(0.8, 1.5),
                        x: () => `+=${gsap.utils.random(-btnRect.width * 0.4, btnRect.width * 0.4)}`,
                        opacity: 0,
                        duration: () => gsap.utils.random(1.5, cooldownDuration),
                        stagger: {
                            each: 0.08,
                            from: "random"
                        },
                        ease: "power1.out"
                    });
                },
                
                triggerTheTruth() {
                    const btn = App.elements.newReasonBtn;
                    btn.disabled = true; 
                    
                    gsap.to(btn, {
                        opacity: 0,
                        scale: 0.8,
                        duration: 0.4,
                        ease: 'back.in(1.7)',
                        onComplete: () => {
                            btn.innerHTML = 'wanna know the truth❓';
                            btn.onclick = () => {
                                btn.onclick = null; 
                                App.Celebration.startTheTruthSequence();
                            };
                            btn.disabled = false; 
                            gsap.to(btn, { opacity: 1, scale: 1, duration: 0.4, ease: 'back.out(1.7)' });
                        }
                    });
                },
                
                // --- NEW: Functions to manage the surprise section ---
                // ...inside the Content: object
addSurpriseSection() {
    if (App.state.surprise.isSectionAdded) return;
    App.state.surprise.isSectionAdded = true;

    // --- The class "animate-on-scroll" has been removed from the line below ---
    const surpriseHTML = `
        <section id="surprise-section" class="card">
            <h2 id="surprise-heading">${CONFIG.surprise.heading}</h2>
            <p id="surprise-subheading">${CONFIG.surprise.subheading}</p>
            <div id="surprise-reveal-timer">Reveal in...</div>
            <div class="surprise-content">
                <img id="surprise-image" src="${CONFIG.surprise.imageSrc}" alt="A special surprise">
                <a href="${CONFIG.surprise.linkHref}" id="surprise-link" target="_blank" rel="noopener noreferrer">Click for your surprise</a>
            </div>
        </section>
    `;
    
    // Insert before the "Journey" section
    const journeySection = document.getElementById('journey');
    journeySection.insertAdjacentHTML('beforebegin', surpriseHTML);
    
    // Manually trigger the scroll animation for the new section
    const newSection = document.getElementById('surprise-section');
    gsap.set(newSection, { opacity: 0, y: 50 });
    ScrollTrigger.create({
        trigger: newSection,
        start: 'top 85%',
        // We only need the animation to happen once when it enters the view
        onEnter: () => gsap.to(newSection, { opacity: 1, y: 0, duration: 0.8, ease: 'power3.out' }),
        once: true // This ensures the animation only runs once and doesn't hide on scroll back
    });

    this.startSurpriseCountdown();
},


                startSurpriseCountdown() {
                    let timeLeft = CONFIG.surprise.countdown;
                    const timerEl = document.getElementById('surprise-reveal-timer');
                    
                    timerEl.textContent = `Reveal in ${timeLeft}...`;

                    const interval = setInterval(() => {
                        timeLeft--;
                        timerEl.textContent = `Reveal in ${timeLeft}...`;
                        if (timeLeft <= 0) {
                            clearInterval(interval);
                            this.revealSurprise();
                        }
                    }, 1000);
                },

                revealSurprise() {
                    const timerEl = document.getElementById('surprise-reveal-timer');
                    const imageEl = document.getElementById('surprise-image');
                    const linkEl = document.getElementById('surprise-link');
                    const headingEl = document.getElementById('surprise-heading');

                    gsap.to(timerEl, {
                        opacity: 0,
                        scale: 0.5,
                        duration: 0.5,
                        ease: 'back.in(1.7)',
                        onComplete: () => timerEl.remove()
                    });
                    
                    const tl = gsap.timeline();
                    
                    tl.to(headingEl, {
                        text: "Surprise Unlocked!",
                        duration: 1.5,
                        ease: 'none'
                    })
                    .to([imageEl, linkEl], {
                        filter: 'blur(0px)',
                        duration: 2,
                        ease: 'power3.out'
                    }, "-=1")
                    .to(linkEl, {
                        opacity: 1,
                        pointerEvents: 'all',
                        duration: 1
                    }, "-=1.5")
                    .fromTo(linkEl, 
                        { scale: 1 },
                        { 
                            scale: 1.1, 
                            color: 'var(--accent-color)',
                            textShadow: '0 0 15px var(--accent-color)',
                            repeat: -1, 
                            yoyo: true, 
                            duration: 1,
                            ease: 'power1.inOut'
                        }
                    );
                }


            },
            
            Audio: {
                playIconPath: "M8 5v14l11-7z",
                pauseIconPath: "M6 19h4V5H6v14zm8-14v14h4V5h-4z",
                
                setupMusicPlayer() {
                    const { playlist } = CONFIG;
                    if (!playlist || playlist.length === 0) { App.elements.playlistSection.style.display = 'none'; return; }
                    App.state.playlist.data = playlist;
                    this.loadTrack(0);
                    App.elements.audio.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                    App.elements.audio.prevBtn.addEventListener('click', () => this.playPrev());
                    App.elements.audio.nextBtn.addEventListener('click', () => this.playNext());
                    App.elements.audio.player.addEventListener('ended', () => this.playNext());
                    App.elements.audio.player.addEventListener('timeupdate', (e) => this.updateProgress(e));
                    App.elements.audio.progressContainer.addEventListener('click', (e) => this.setProgress(e));
                },

                initAudioVisualizer() {
                    if (App.state.playlist.audioContext) return;
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    App.state.playlist.audioContext = new AudioContext();
                    const source = App.state.playlist.audioContext.createMediaElementSource(App.elements.audio.player);
                    App.state.playlist.analyser = App.state.playlist.audioContext.createAnalyser();
                    source.connect(App.state.playlist.analyser);
                    App.state.playlist.analyser.connect(App.state.playlist.audioContext.destination);
                    App.state.playlist.analyser.fftSize = 128;
                    const bufferLength = App.state.playlist.analyser.frequencyBinCount;
                    const dataArray = new Uint8Array(bufferLength);
                    const canvas = App.elements.audio.visualizer;
                    const ctx = canvas.getContext('2d');
                    const { width, height } = canvas;
                    
                    function draw() {
                        requestAnimationFrame(draw);
                        App.state.playlist.analyser.getByteFrequencyData(dataArray);
                        ctx.clearRect(0, 0, width, height);
                        const barWidth = (width / bufferLength) * 1.5;
                        let x = 0;
                        let sum = 0;
                        for (let i = 0; i < bufferLength; i++) {
                            const barHeight = (dataArray[i] / 255) * height * 0.8;
                            sum += dataArray[i];
                            const gradient = ctx.createLinearGradient(0, height, 0, height - barHeight);
                            gradient.addColorStop(0, 'rgba(224, 64, 251, 0.7)');
                            gradient.addColorStop(1, 'rgba(255, 64, 129, 0.9)');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(x, height - barHeight, barWidth, barHeight);
                            x += barWidth + 2;
                        }

                        const pState = App.state.playlist;
                        if (pState.isPlaying) {
                            const avg = sum / bufferLength;
                            const now = Date.now();
                            if (avg > pState.beatThreshold && now - pState.lastBeatTime > 200) {
                                pState.lastBeatTime = now;
                                if (App.state.heartParticles && App.state.heartParticles.length > 0) {
                                    App.state.heartParticles.forEach(p => {
                                        if (!p.isBurst) { 
                                            p.initialScale = p.scale;
                                            p.targetScale = 1.4; 
                                            p.scaleProgress = 0; 
                                        }
                                    });
                                }
                            }
                        }

                    }
                    draw();
                },

                loadTrack(index) {
                    const track = App.state.playlist.data[index];
                    App.elements.audio.trackTitle.textContent = track.title;
                    App.elements.audio.trackArtist.textContent = track.artist;
                    App.elements.audio.trackArt.style.backgroundImage = `url('${track.art}')`;
                    App.elements.audio.player.src = track.src;
                },

                togglePlayPause() {
                    if (App.state.playlist.audioContext && App.state.playlist.audioContext.state === 'suspended') { App.state.playlist.audioContext.resume(); }
                    App.state.playlist.isPlaying ? this.pauseTrack() : this.playTrack();
                },

                playTrack() {
                    App.elements.audio.player.play();
                    App.elements.audio.playPauseIcon.querySelector('path').setAttribute('d', this.pauseIconPath);
                    document.querySelector('.music-player').classList.add('is-playing');
                    App.state.playlist.isPlaying = true;
                    if (!App.state.playlist.audioContext) { this.initAudioVisualizer(); }
                },

                pauseTrack() {
                    App.elements.audio.player.pause();
                    App.elements.audio.playPauseIcon.querySelector('path').setAttribute('d', this.playIconPath);
                    document.querySelector('.music-player').classList.remove('is-playing');
                    App.state.playlist.isPlaying = false;
                },

                playPrev() {
                    const len = App.state.playlist.data.length;
                    App.state.playlist.currentIndex = (App.state.playlist.currentIndex - 1 + len) % len;
                    this.loadTrack(App.state.playlist.currentIndex);
                    this.playTrack();
                },

                playNext() {
                    App.state.playlist.currentIndex = (App.state.playlist.currentIndex + 1) % App.state.playlist.data.length;
                    this.loadTrack(App.state.playlist.currentIndex);
                    this.playTrack();
                },

                updateProgress(e) {
                    const { duration, currentTime } = e.srcElement;
                    if (duration) { App.elements.audio.progressBar.style.width = `${(currentTime / duration) * 100}%`; }
                },

                setProgress(e) {
                    const width = App.elements.audio.progressContainer.clientWidth;
                    const clickX = e.offsetX;
                    const duration = App.elements.audio.player.duration;
                    if (duration) { App.elements.audio.player.currentTime = (clickX / width) * duration; }
                }
            },
            
            Animations: {
                initPreloader() {
                    const { preloader, preloaderHeart, loaderText, loaderProgress } = App.elements;
                    const ecgContainer = document.getElementById('ecg-container');
                    const playButton = document.getElementById('play-button');
                    const heartbeatAudio = document.getElementById('heartbeat-audio');
                    const loadingDuration = 4;

                    document.body.classList.add('no-scroll');
                    gsap.set([loaderText, loaderProgress, ecgContainer, preloaderHeart], { opacity: 0 });
                    gsap.set(playButton, {opacity: 1}); 
                    gsap.set(preloaderHeart, {opacity: 1});

                    playButton.addEventListener('click', () => {
                        gsap.to(playButton, { opacity: 0, scale: 0, duration: 0.3, onComplete: () => { playButton.style.display = 'none'; } });
                        heartbeatAudio.play().catch(e => {
                            console.error("Audio playback failed:", e);
                            //loaderText.textContent = "Audio unavailable, but we're still preparing!";
                        });
                        if (navigator.vibrate) { navigator.vibrate([200, 100, 200, 100, 200, 100, 200]); }

                        App.state.preloaderTimeline = gsap.timeline({
                            onComplete: () => {
                                heartbeatAudio.pause();
                                heartbeatAudio.currentTime = 0;
                                if (navigator.vibrate) { navigator.vibrate(0); }
                                gsap.to(preloader, {
                                    opacity: 0,
                                    duration: 1.0,
                                    ease: 'power2.inOut',
                                    onComplete: () => {
                                        preloader.style.display = 'none';
                                        document.body.classList.remove('no-scroll');
                                        App.start();
                                    }
                                });
                            }
                        });

                        App.state.preloaderTimeline
                            .to([loaderText, loaderProgress, ecgContainer], { opacity: 1, duration: 0.5, ease: 'power1.out' })
                            .to(loaderProgress, {
                                textContent: 100,
                                roundProps: "textContent",
                                duration: loadingDuration,
                                ease: "power1.out",
                                onUpdate: function() { this.targets()[0].innerText = `${this.targets()[0].textContent}%`; }
                            }, 0);

                        const beatLoop = gsap.timeline({ repeat: -1 }).to(preloaderHeart, { scale: 1.15, duration: 0.15, ease: 'power1.inOut' }).to(preloaderHeart, { scale: 1.0, duration: 0.6, ease: 'power1.inOut' });
                        const ecgLoop = gsap.timeline({ repeat: -1 }).fromTo(App.elements.ecgMask, { attr: { x: -400 } }, { attr: { x: 400 }, duration: 1.5, ease: 'linear' });

                        App.state.preloaderTimeline.add(beatLoop, 0.5);
                        App.state.preloaderTimeline.add(ecgLoop, 0.5);

                        setTimeout(() => { App.state.preloaderTimeline.progress(1); }, loadingDuration * 1000 + 500);
                    }, { once: true });
                },

                                initMainPageAnimations() {
                    gsap.to(App.elements.contentWrapper, { visibility: 'visible', duration: 0 });
                    const mainHeading = App.elements.mainHeading;
                    const text = mainHeading.textContent;
                    mainHeading.innerHTML = '';
                    text.split('').forEach(char => {
                        const span = document.createElement('span');
                        span.className = 'char';
                        span.innerHTML = char === ' ' ? '&nbsp;' : char;
                        mainHeading.appendChild(span);
                    });
                    const tl = gsap.timeline();
                    tl.from('.char', { y: 50, opacity: 0, stagger: 0.05, duration: 1, ease: 'back.out(1.7)' })
                      .from('#header-subtitle', { y: 20, opacity: 0, duration: 0.8, ease: 'power2.out' }, '-=0.5');

                    document.querySelectorAll('.animate-on-scroll').forEach(el => {
                        gsap.set(el, { opacity: 0, y: 50 });
                        ScrollTrigger.create({
                            trigger: el,
                            start: 'top 85%',
                            end: 'bottom 15%',
                            onEnter: () => gsap.to(el, { opacity: 1, y: 0, duration: 0.8, ease: 'power3.out' }),
                            onLeaveBack: () => gsap.to(el, { opacity: 0, y: 50, duration: 0.6, ease: 'power3.in' }),
                        });
                        el.addEventListener('mousemove', (e) => {
                            const { left, top, width, height } = el.getBoundingClientRect();
                            const x = (e.clientX - left) / width - 0.5;
                            const y = (e.clientY - top) / height - 0.5;
                            gsap.to(el, { rotationY: x * 10, rotationX: -y * 10, transformPerspective: 1000, ease: 'power1.out', duration: 0.5 });
                        });
                        el.addEventListener('mouseleave', () => {
                            gsap.to(el, { rotationY: 0, rotationX: 0, ease: 'elastic.out(1, 0.5)', duration: 1 });
                        });
                    });
                    
                    // --- ADD THIS NEW CODE AT THE END ---
                    // Animate the heart toggle button to appear for everyone
                    gsap.to(App.elements.toggles.heartsBtn, {
                        opacity: 1,
                        scale: 1,
                        duration: 0.8,
                        ease: 'elastic.out(1, 0.4)',
                        delay: 0.5 // Short delay after the main heading appears
                    });
                }

            },
            
                                                Celebration: {
                start() {
                    console.log("Starting initial birthday celebration! 🎉");
                    if (typeof confetti === 'undefined') { console.error("Confetti library not loaded."); return; }

                    const duration = 5 * 1000;
                    const animationEnd = Date.now() + duration;
                    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };

                    function randomInRange(min, max) { return Math.random() * (max - min) + min; }
                    
                    const interval = setInterval(function() {
                        const timeLeft = animationEnd - Date.now();
                        if (timeLeft <= 0) {
                            clearInterval(interval);
                            const playBtn = App.elements.celebration.playBtn;

                            // Make the "Start Celebration" button visible and animate it
                            playBtn.style.display = 'flex';
                            gsap.to(playBtn, { opacity: 1, scale: 1, duration: 0.8, ease: 'elastic.out(1, 0.3)' });
                            return;
                        }
                        const particleCount = 500 * (timeLeft / duration);
                        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
                    }, 250);
                },




                                                startMassCelebration() {
                    console.log("Starting MASS celebration! 🎈🎵");
                    if (App.state.game.isActive) return;
                    App.state.isCelebrationActive = true;
                    
                    const playBtn = App.elements.celebration.playBtn;
                    gsap.to(playBtn, { opacity: 0, scale: 0.8, duration: 0.5, ease: 'back.in(1.7)', onComplete: () => playBtn.style.display = 'none' });

                    // --- ❗️ NEW LOGIC TO SHOW THE BALLOON TOGGLE ---
                    const balloonsBtn = App.elements.toggles.balloonsBtn;
                    balloonsBtn.style.display = 'flex'; // Make it visible...
                    // ...and animate it in.
                    gsap.to(balloonsBtn, {
                        opacity: 1,
                        scale: 1,
                        duration: 0.8,
                        ease: 'elastic.out(1, 0.4)'
                    });
                    // --- END OF NEW LOGIC ---

                    // Check if the game is unlockable and show the game button
                    if (App.state.game.isUnlockable) {
                        const gameBtn = App.elements.game.playBtn;
                        gsap.to(gameBtn, {
                            scale: 1,
                            opacity: 1,
                            duration: 0.8,
                            ease: 'elastic.out(1, 0.4)',
                            delay: 0.5 
                        });
                    }

                    const audioPlayer = App.elements.celebration.audioPlayer;
                    audioPlayer.src = CONFIG.celebration.song;
                    audioPlayer.play().catch(e => console.error("Celebration audio failed to play:", e));

                    setInterval(() => {
                        if (App.state.isCelebrationActive) {
                            App.UI.addCelebrationBalloon();
                        }
                    }, 800);
                },



                preloadPopSounds() {
                    const container = App.elements.celebration.popSoundsContainer;
                    CONFIG.celebration.popSounds.forEach(src => {
                        const audio = new Audio();
                        audio.src = src;
                        audio.preload = "auto";
                        App.state.popSoundPlayers.push(audio);
                        container.appendChild(audio);
                    });
                },

                handleBalloonPop(popLocation) { 
                    if (!popLocation) return;

                    const soundPlayers = App.state.popSoundPlayers;
                    if (soundPlayers.length > 0) {
                        soundPlayers[App.state.popSoundIndex].currentTime = 0;
                        soundPlayers[App.state.popSoundIndex].play();
                        App.state.popSoundIndex = (App.state.popSoundIndex + 1) % soundPlayers.length;
                    }

                    const origin = {
                        x: popLocation.x / window.innerWidth,
                        y: popLocation.y / window.innerHeight
                    };

                    confetti({
                        particleCount: 50,
                        spread: 70,
                        origin: origin,
                        zIndex: 9999999 
                    });
                },

                startTheTruthSequence() {
                    const overlay = document.getElementById('truth-overlay');
                    const truthCanvas = document.getElementById('truth-text-canvas');
                    const cancelBtn = document.getElementById('truth-cancel-btn');
                    const btn = App.elements.newReasonBtn;

                    btn.disabled = true;
                    btn.onclick = null;
                    
                    overlay.style.display = 'block';
                    overlay.style.pointerEvents = 'all'; 

                    gsap.to(overlay, {
                        opacity: 1,
                        duration: 1,
                        onStart: () => {
                            overlay.classList.add('visible');
                            document.body.classList.add('no-scroll');
                        },
                        onComplete: showFirstBalloon
                    });

                    function showFirstBalloon() {
                        const balloon = document.createElement('div');
                        balloon.className = 'rainbow-balloon';
                        overlay.appendChild(balloon);

                        gsap.to(balloon, {
                            y: -(window.innerHeight / 2) - 130,
                            duration: 4,
                            ease: 'power1.out',
                            onComplete: () => {
                                gsap.to(balloon, { y: '+=20', rotation: 5, yoyo: true, repeat: -1, duration: 2, ease: 'sine.inOut' });
                                balloon.addEventListener('click', popFirstBalloon, { once: true });
                            }
                        });
                    }

                    function popFirstBalloon(event) {
                        const balloon = event.currentTarget;
                        const rect = balloon.getBoundingClientRect();

                        confetti({
                            particleCount: 150,
                            spread: 90,
                            zIndex:9999999,
                            origin: { x: (rect.left + rect.width / 2) / window.innerWidth, y: (rect.top + rect.height / 2) / window.innerHeight },
                            colors: ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#8b00ff']
                        });

                        gsap.to(balloon, {
                            scale: 1.5,
                            opacity: 0,
                            duration: 0.3,
                            ease: 'power1.in',
                            onComplete: () => {
                                balloon.remove();
                                showLiquidText();
                            }
                        });
                    }

                    function showLiquidText() {
    const text = "👀True love needs no reason for it to flow...😌💞";
    truthCanvas.style.display = 'block';
    const ctx = truthCanvas.getContext('2d');
    truthCanvas.width = window.innerWidth;
    truthCanvas.height = window.innerHeight;

    // Font configuration
    const baseFontSize = 10;
    const maxFontSize = 80;
    const minFontSize = 24;
    const fontSize = Math.min(
        maxFontSize,
        Math.max(
            minFontSize,
            window.innerWidth * 0.015 * baseFontSize
        )
    );

    // Set text properties
    ctx.font = `bold ${fontSize}px 'Comic Neue', cursive`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    // Create gradient
    const gradient = ctx.createLinearGradient(0, 0, truthCanvas.width, 0);
    gradient.addColorStop(0, '#FC7F03');
    gradient.addColorStop(0.3, '#ff1493');
    gradient.addColorStop(0.7, '#ff00ff');
    gradient.addColorStop(1, '#8a2be2');
    
    // Glow animation variables
    let glowPulse = 0;
    const pulseGlow = () => {
        glowPulse += 0.05;
        const pulseIntensity = 10 + Math.sin(glowPulse) * 10;
        ctx.shadowBlur = 30 + pulseIntensity;
        ctx.shadowColor = 'rgba(255, 0, 255, 0.9)'; // Electric pink
        requestAnimationFrame(pulseGlow);
    };

    // Calculate text position (centered)
    const lines = wrapText(ctx, text, truthCanvas.width * 0.8);
    const lineHeight = fontSize * 1.5;
    const totalHeight = lines.length * lineHeight;
    const startY = (truthCanvas.height - totalHeight) / 2;

    // Animation variables
    let currentIndex = 0;
    let currentLine = 0;
    let currentText = '';
    const letterDelay = 100;

    const drawText = () => {
        ctx.clearRect(0, 0, truthCanvas.width, truthCanvas.height);
        
        // Draw text with white background first
        ctx.save();
        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)'; // Semi-transparent white
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        ctx.lineWidth = 2;
        
        // Draw background for existing lines
        for (let i = 0; i < currentLine; i++) {
            ctx.strokeText(lines[i], truthCanvas.width / 2, startY + (i * lineHeight));
            ctx.fillText(lines[i], truthCanvas.width / 2, startY + (i * lineHeight));
        }
        
        // Draw background for current line
        if (currentLine < lines.length) {
            ctx.strokeText(currentText, truthCanvas.width / 2, startY + (currentLine * lineHeight));
            ctx.fillText(currentText, truthCanvas.width / 2, startY + (currentLine * lineHeight));
        }
        ctx.restore();
        
        // Draw glow layers
        ctx.save();
        ctx.shadowBlur = 50;
        ctx.shadowColor = 'rgba(138, 43, 226, 0.6)';
        ctx.fillStyle = gradient;
        for (let i = 0; i < currentLine; i++) {
            ctx.fillText(lines[i], truthCanvas.width / 2, startY + (i * lineHeight));
        }
        if (currentLine < lines.length) {
            ctx.fillText(currentText, truthCanvas.width / 2, startY + (currentLine * lineHeight));
        }
        ctx.restore();
        
        // Draw core text
        ctx.shadowBlur = 20;
        ctx.shadowColor = 'rgba(255, 255, 255, 0.9)';
        ctx.fillStyle = gradient;
        for (let i = 0; i < currentLine; i++) {
            ctx.fillText(lines[i], truthCanvas.width / 2, startY + (i * lineHeight));
        }
        if (currentLine < lines.length) {
            ctx.fillText(currentText, truthCanvas.width / 2, startY + (currentLine * lineHeight));
        }
    };

    const animateText = () => {
        if (currentLine < lines.length) {
            if (currentIndex < lines[currentLine].length) {
                currentText += lines[currentLine][currentIndex];
                currentIndex++;
                drawText();
                setTimeout(animateText, letterDelay);
            } else {
                currentLine++;
                currentIndex = 0;
                currentText = '';
                setTimeout(animateText, letterDelay * 0.5);
            }
        } else {
            // Start pulsing glow when animation completes
            pulseGlow();
            
            // Show cancel button
            cancelBtn.style.display = 'block';
            gsap.to(cancelBtn, { 
                opacity: 1, 
                scale: 1, 
                duration: 0.5, 
                ease: 'back.out(1.7)' 
            });
            cancelBtn.onclick = cancelAndProceed;
        }
    };

    // Helper function to wrap text
    function wrapText(context, text, maxWidth) {
        const words = text.split(' ');
        const lines = [];
        let currentLine = words[0];

        for (let i = 1; i < words.length; i++) {
            const word = words[i];
            const width = context.measureText(currentLine + ' ' + word).width;
            if (width < maxWidth) {
                currentLine += ' ' + word;
            } else {
                lines.push(currentLine);
                currentLine = word;
            }
        }
        lines.push(currentLine);
        return lines;
    }

    // Start the animation
    gsap.to(truthCanvas, {
        opacity: 1,
        duration: 1,
        onStart: animateText
    });
}

                    function cancelAndProceed() {
                        gsap.to([truthCanvas, cancelBtn], { opacity: 0, duration: 0.5, onComplete: () => {
                            truthCanvas.style.display = 'none';
                            cancelBtn.style.display = 'none';
                            startThreeBalloons();
                        }});
                    }

                    function startThreeBalloons() {
                        const words = [ { id: '#word-i', text: 'I' }, { id: '#word-lubhh', text: 'Lubhh💞' }, { id: '#word-booh', text: 'Booh🫵🏼' } ];
                        let currentBalloonIndex = 0;

                        function showNextBalloon() {
                            if (currentBalloonIndex >= words.length) {
                                finalCinematicMerge();
                                return;
                            }
                            
                            const balloon = document.createElement('div');
                            balloon.className = 'rainbow-balloon';
                            balloon.style.width = '150px';
                            balloon.style.height = '195px';
                            const balloonPositions = ['25%', '50%', '75%'];
                            balloon.style.left = balloonPositions[currentBalloonIndex];
                            overlay.appendChild(balloon);

                            gsap.to(balloon, {
                                y: - (window.innerHeight / 2) - 100,
                                duration: 3,
                                ease: 'power1.out',
                                onComplete: () => {
                                    gsap.to(balloon, { y: '+=15', yoyo: true, repeat: -1, duration: 1.8, ease: 'sine.inOut' });
                                    balloon.addEventListener('click', (e) => {
                                        popSingleBalloon(e, words[currentBalloonIndex].id, showNextBalloon);
                                        currentBalloonIndex++;
                                    }, { once: true });
                                }
                            });
                        }
                        showNextBalloon();
                    }

                    function popSingleBalloon(event, wordId, callback) {
                        const balloon = event.currentTarget;
                        const wordEl = document.querySelector(wordId);
                        const rect = balloon.getBoundingClientRect();
                        
                        confetti({ particleCount: 50,zIndex:10006,spread: 60, origin: { x: (rect.left + rect.width/2) / window.innerWidth, y: (rect.top + rect.height/2) / window.innerHeight }});
                        gsap.to(balloon, { scale: 1.5, opacity: 0, duration: 0.3, onComplete: () => balloon.remove() });

                        let offsetX = 0, offsetY = 0; 
                        switch (wordId) {
                            case '#word-i': offsetX = 10; offsetY = -40; break;
                            case '#word-lubhh': offsetX = 20; offsetY = -30; break;
                            case '#word-booh': offsetX = 30; offsetY = -50; break;
                        }
                        gsap.set(wordEl, { top: `${rect.top + rect.height / 2 + offsetY}px`, left: `${rect.left + rect.width / 2 + offsetX}px` });
                        gsap.to(wordEl, { opacity: 1, scale: 1, duration: 0.5, ease: 'back.out(1.7)' });
                        if (callback) { setTimeout(callback, 500); }
                    }

                    function finalCinematicMerge() {
                        const wordI = document.querySelector('#word-i');
                        const wordLubhh = document.querySelector('#word-lubhh');
                        const wordBooh = document.querySelector('#word-booh');

                        gsap.timeline({ onComplete: finalCelebration })
                            .to(wordI, { left: '50%', top: '30vh', duration: 1.5, ease: 'back.inOut(1.7)' }, "<")
                            .to(wordLubhh, { left: '50%', top: '52vh', duration: 1.5, ease: 'back.inOut(1.7)' }, "<")
                            .to(wordBooh, { left: '50%', top: '74vh', duration: 1.5, ease: 'back.inOut(1.7)' }, "<")
                            .to([wordI, wordLubhh, wordBooh], { scale: 1.5, textShadow: '0 0 30px #ff4081, 0 0 50px #FC7F03', duration: 1, ease: 'elastic.out(1, 0.5)' });
                    }

                    function finalCelebration() {
                        const duration = 5 * 1000; const end = Date.now() + duration;
                        (function frame() {
                            confetti({ particleCount: 5,zIndex:10006,angle: 60, spread: 55, origin: { x: 0 }, colors: ['#FC7F03', '#ff4081', '#ffffff'] });
                            confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#FC7F03', '#ff4081', '#ffffff'] });
                            if (Date.now() < end) {
                                requestAnimationFrame(frame);
                            } else {
                                gsap.to(['#word-i', '#word-lubhh', '#word-booh'], {
                                    opacity: 0, scale: 0, duration: 0.5,
                                    onComplete: function() {
                                        gsap.set(['#word-i', '#word-lubhh', '#word-booh'], { top: '50%', left: '50%', transform: 'translate(-50%, -50%) scale(0)' });
                                    }
                                });
                                gsap.to('#truth-overlay', {
                                    opacity: 0, duration: 2,
                                    onComplete: () => {
                                        document.getElementById('truth-overlay').style.display = 'none';
                                        document.body.classList.remove('no-scroll');
                                        App.Content.setupReasonsGenerator(); 
                                        App.elements.newReasonBtn.innerHTML = 'Show Me Another';
                                        App.elements.newReasonBtn.onclick = () => App.Content.generateNewReason();
                                        App.elements.newReasonBtn.disabled = false;
                                    }
                                });
                            }
                        }());
                    }
                }
            },

            Game: {
                init() {
                    const storedHighScores = localStorage.getItem('balloonGameHighScores');
                    if (storedHighScores) {
                        App.state.game.highScores = JSON.parse(storedHighScores);
                    }
                    const storedHistory = localStorage.getItem('balloonGameHistory');
                    if (storedHistory) {
                        App.state.game.gameHistory = JSON.parse(storedHistory);
                    }
                },

                _showScreen(screenToShow) {
                    const gameElements = App.elements.game;
                    const allScreens = [
                        gameElements.mainMenu,
                        gameElements.startScreen,
                        gameElements.highScoresScreen,
                        gameElements.historyScreen,
                        gameElements.endScreen,
                        gameElements.pauseScreen,
                        gameElements.quitConfirmScreen
                    ];
                    allScreens.forEach(screen => screen.style.display = 'none');
                    screenToShow.style.display = 'flex';
                },

                showMainMenu() {
                    const gameElements = App.elements.game;
                    gameElements.overlay.style.display = 'flex';
                    gsap.fromTo(gameElements.overlay, { opacity: 0 }, { opacity: 1, duration: 0.3 });
                    this._showScreen(gameElements.mainMenu);
                },

                showDifficultySelector() {
                    this._showScreen(App.elements.game.startScreen);
                },

                showHighScores() {
                    const gameElements = App.elements.game;
                    const highScores = App.state.game.highScores;
                    gameElements.highScoresList.innerHTML = `
                        <p>Easy: <span>${highScores.easy}</span></p>
                        <p>Medium: <span>${highScores.medium}</span></p>
                        <p>Hard: <span>${highScores.hard}</span></p>
                    `;
                    this._showScreen(gameElements.highScoresScreen);
                },

                showHistory() {
                    const gameElements = App.elements.game;
                    const history = App.state.game.gameHistory;
                    let historyHTML = '';
                    if (history.length === 0) {
                        historyHTML = '<p>No games played yet!</p>';
                    } else {
                        [...history].reverse().forEach(game => {
                            historyHTML += `<p>${game.date} - Mode: <span>${game.difficulty}</span>, Score: <span>${game.score}</span></p>`;
                        });
                    }
                    gameElements.historyList.innerHTML = historyHTML;
                    this._showScreen(gameElements.historyScreen);
                },

                closeOverlay() {
                    const gameElements = App.elements.game;
                    gsap.to(gameElements.overlay, {
                        opacity: 0,
                        duration: 0.3,
                        onComplete: () => gameElements.overlay.style.display = 'none'
                    });
                },

                start(difficulty) {
                    console.log(`Starting Balloon Pop Game with difficulty: ${difficulty}`);
                    const game = App.state.game;
                    const gameElements = App.elements.game;

                    game.difficulty = difficulty;
                    game.isActive = true;
                    game.isPaused = false;
                    game.score = 0;
                    game.timeLeft = 30;

                    clearInterval(game.gameInterval);
                    clearInterval(game.balloonSpawnInterval);
                    
                    this._showScreen(document.createElement('div'));

                    gameElements.ui.classList.remove('hidden-element');
                    gameElements.score.textContent = game.score;
                    gameElements.timer.textContent = game.timeLeft;
                    gameElements.highScoreUI.textContent = `${game.highScores[game.difficulty]} (${game.difficulty})`;
                    gameElements.pauseBtn.innerHTML = '❚❚';

                    game.gameInterval = setInterval(() => this.update(), 1000);
                    const spawnRate = difficulty === 'easy' ? 650 : (difficulty === 'medium' ? 500 : 450);
                    game.balloonSpawnInterval = setInterval(() => this.spawnGameBalloon(), spawnRate);
                },

                update() {
                    const game = App.state.game;
                    if (!game.isActive || game.isPaused) return;
                    game.timeLeft--;
                    App.elements.game.timer.textContent = game.timeLeft;
                    if (game.timeLeft <= 0) {
                        this.end();
                    }
                },

                pause() {
                    const game = App.state.game;
                    if (!game.isActive || game.isPaused) return;
                    game.isPaused = true;
                    clearInterval(game.gameInterval);
                    clearInterval(game.balloonSpawnInterval);
                    this._showScreen(App.elements.game.pauseScreen);
                    App.elements.game.pauseBtn.innerHTML = '▶';
                },

                resume() {
                    const game = App.state.game;
                    const spawnRate = game.difficulty === 'easy' ? 650 : (game.difficulty === 'medium' ? 500 : 450);
                    if (!game.isActive || !game.isPaused) return;

                    game.isPaused = false;
                    this._showScreen(document.createElement('div')); 

                    App.elements.game.pauseBtn.innerHTML = '❚❚';
                    game.gameInterval = setInterval(() => this.update(), 1000);
                    game.balloonSpawnInterval = setInterval(() => this.spawnGameBalloon(), spawnRate);
                },

                end() {
                    const game = App.state.game;
                    const gameElements = App.elements.game;
                    if (!game.isActive) return;

                    game.isActive = false;
                    clearInterval(game.gameInterval);
                    clearInterval(game.balloonSpawnInterval);

                    gameElements.ui.classList.add('hidden-element');

                    const now = new Date();
                    const gameRecord = {
                        date: now.toLocaleString(),
                        score: game.score,
                        difficulty: game.difficulty
                    };
                    game.gameHistory.push(gameRecord);
                    localStorage.setItem('balloonGameHistory', JSON.stringify(game.gameHistory));

                    let newHighScore = false;
                    if (game.score > game.highScores[game.difficulty]) {
                        game.highScores[game.difficulty] = game.score;
                        localStorage.setItem('balloonGameHighScores', JSON.stringify(game.highScores));
                        newHighScore = true;
                    }

                    gameElements.finalScore.textContent = game.score;
                    if (newHighScore) {
                        gameElements.newHighScoreMode.textContent = game.difficulty;
                        gameElements.newHighScoreMsg.classList.add('new-high-score-achieved');
                    } else {
                        gameElements.newHighScoreMsg.classList.remove('new-high-score-achieved');
                    }

                    this._showScreen(gameElements.endScreen);
                    gsap.from(gameElements.endScreen, { scale: 0.7, opacity: 0, duration: 0.5, ease: 'back.out(1.7)' });

                    gameElements.overlay.querySelectorAll('.balloon-particle').forEach(b => b.remove());
                },
                
                promptToQuit() {
                    const game = App.state.game;
                    if (!game.isActive || game.isPaused) return;
                    this.pause(); 
                    this._showScreen(App.elements.game.quitConfirmScreen);
                    App.elements.game.quitConfirmScore.textContent = game.score;
                },

                quit() {
                    this.end(); 
                    this.showMainMenu(); 
                },

                spawnGameBalloon() {
                    const container = App.elements.game.overlay;
                    const balloon = document.createElement('div');
                    balloon.classList.add('balloon-particle');
                    const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
                    balloon.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                    const size = gsap.utils.random(70, 110);
                    const startX = gsap.utils.random(5, 95) + 'vw';

                    let yStart, yEnd, duration, xEnd = '+=0';
                    const difficulty = App.state.game.difficulty;

                    switch (difficulty) {
                        case 'easy':
                            yStart = '110vh'; yEnd = '-120vh'; duration = gsap.utils.random(5.0, 7.0);
                            break;
                        case 'medium':
                            duration = gsap.utils.random(3.5, 5.0);
                            if (Math.random() < 0.7) { yStart = '110vh'; yEnd = '-120vh'; }
                            else { yStart = '-20vh'; yEnd = '120vh'; }
                            break;
                        case 'hard':
                            duration = gsap.utils.random(2.5, 3.8);
                            xEnd = gsap.utils.random(-30, 30) + 'vw';
                            if (Math.random() < 0.5) { yStart = '110vh'; yEnd = '-120vh'; }
                            else { yStart = '-20vh'; yEnd = '120vh'; }
                            break;
                    }

                    gsap.set(balloon, { width: size, height: size * 1.25, x: startX, y: yStart });
                    container.appendChild(balloon);

                    gsap.to(balloon, {
                        y: yEnd, x: xEnd, duration: duration, ease: 'none',
                        onComplete: () => balloon.remove()
                    });

                    balloon.addEventListener('click', (e) => {
                        if (App.state.game.isActive && !App.state.game.isPaused) this.scorePoint(e.currentTarget);
                    }, { once: true });
                },

                scorePoint(balloonElement) {
                    if (balloonElement.classList.contains('is-popped')) return;
                    balloonElement.classList.add('is-popped');

                    App.state.game.score++;
                    App.elements.game.score.textContent = App.state.game.score;

                    gsap.fromTo(App.elements.game.score,
                        { scale: 1.6, color: '#ffd600' },
                        { scale: 1, color: 'white', duration: 0.5, ease: 'elastic.out(1, 0.4)' }
                    );

                    const rect = balloonElement.getBoundingClientRect();
                    const popLocation = {
                        x: rect.left + rect.width / 2,
                        y: rect.top + rect.height / 2
                    };

                    App.Celebration.handleBalloonPop(popLocation);

                    gsap.to(balloonElement, {
                        scale: 1.4, opacity: 0, duration: 0.2, ease: 'power1.in',
                        onComplete: () => balloonElement.remove()
                    });
                }
            }
        };

        App.init();
        App.Game.init();

        (function() {
            const tracker = document.getElementById("scroll-progress-bar");
            let hideTimeout;
            function updatePageScrollTracker() {
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                let progress = (scrollTop / scrollHeight) * 100;
                if (scrollTop >= scrollHeight) progress = 100;
                if (tracker) {
                    tracker.style.width = progress + "%";
                    tracker.style.opacity = 1;
                    clearTimeout(hideTimeout);
                    hideTimeout = setTimeout(() => { tracker.style.opacity = 0; }, 1000);
                }
            }
            window.addEventListener("load", updatePageScrollTracker);
            window.addEventListener("scroll", updatePageScrollTracker);
        })();
    });
    
    const assetsToPreload = [
        'assets/images/photo1.jpg', 'assets/images/photo2.jpg', 'assets/images/photo3.png', 'assets/images/photo4.jpg',
        'assets/images/photo5.png', 'assets/images/photo6.jpg', 'assets/images/journey1.jpg', 'assets/images/journey2.jpg',
        'assets/images/journey3.jpg', 'assets/images/journey4.jpg', 'https://i.ibb.co/fK0ZtJT/balloon.png',
        'assets/audio/song1.mp3', 'assets/audio/song2.mp3', 'assets/audio/song3.mp3', 'assets/audio/heartbeat.mp3',
        'https://cdn.pixabay.com/audio/2022/08/04/audio_2911a06d50.mp3', 'https://cdn.pixabay.com/audio/2021/08/04/audio_bb630cc098.mp3',
        'https://cdn.pixabay.com/audio/2022/03/15/audio_73ed8c1a17.mp3', 'https://cdn.pixabay.com/audio/2021/08/04/audio_c3592a832a.mp3',
        'assets/images/surprise-image.jpg' // Preload the new surprise image
    ];

    function preloadAssets(assets, onComplete) {
        let loadedCount = 0;
        const totalAssets = assets.length;
        if (totalAssets === 0) { onComplete(); return; }
        assets.forEach(path => {
            const isAudio = path.endsWith('.mp3') || path.endsWith('.wav') || path.endsWith('.ogg');
            if (isAudio) {
                const audio = new Audio();
                audio.addEventListener('canplaythrough', assetLoaded, { once: true });
                audio.src = path;
            } else {
                const img = new Image();
                img.onload = assetLoaded;
                img.onerror = assetLoaded; // Count as loaded even if it fails, to not block the site
                img.src = path;
            }
        });
        function assetLoaded() {
            loadedCount++;
            const progress = Math.round((loadedCount / totalAssets) * 100);
            console.log(`Loading... ${progress}%`);
            if (loadedCount === totalAssets) {
                console.log("All assets preloaded!");
                onComplete();
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        preloadAssets(assetsToPreload, () => { /* App.init() is now called from the preloader logic */ });
    });

        const QUOTES = {
        development: [
            { text: "The only person you are destined to become is the person you decide to be.", author: "Ralph Waldo Emerson" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "What we think, we become.", author: "Buddha" },
            { text: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu" },
            { text: "Become a priority in your life.", author: "Anonymous" }
        ],
        romantic: [
            { text: "You are my sun, my moon, and all my stars.", author: "E. E. Cummings" },
            { text: "If I know what love is, it is because of you.", author: "Hermann Hesse" },
            { text: "I love you not only for what you are, but for what I am when I am with you.", author: "Roy Croft" },
            { text: "To love and be loved is to feel the sun from both sides.", author: "David Viscott" },
            { text: "In all the world, there is no heart for me like yours.", author: "Maya Angelou" }
        ],
        wise: [
            { text: "The unexamined life is not worth living.", author: "Socrates" },
            { text: "Yesterday I was clever, so I wanted to change the world. Today I am wise, so I am changing myself.", author: "Rumi" },
            { text: "The only true wisdom is in knowing you know nothing.", author: "Socrates" },
            { text: "Count your age by friends, not years. Count your life by smiles, not tears.", author: "John Lennon" },
            { text: "It is the mark of an educated mind to be able to entertain a thought without accepting it.", author: "Aristotle" }
        ],
        // NEW QUOTES ADDED HERE
        gita: [
            { text: "कर्मण्येवाधिकारस्ते मा फलेषु कदाचन। मा कर्मफलहेतुर्भूर्मा ते सङ्गोऽस्त्वकर्मणि॥", author: "Bhagavad Gita 2.47" },
            { text: "यदा यदा हि धर्मस्य ग्लानिर्भवति भारत। अभ्युत्थानमधर्मस्य तदात्मानं सृजाम्यहम्॥", author: "Bhagavad Gita 4.7" },
            { text: "क्रोधाद्भवति संमोह: संमोहात्स्मृतिविभ्रमः। स्मृतिभ्रंशाद्बुद्धिनाशो बुद्धिनाशात्प्रणश्यति॥", author: "Bhagavad Gita 2.63" },
            { text: "श्रद्धावान्ल्लभते ज्ञानं तत्पर: संयतेन्द्रिय:। ज्ञानं लब्ध्वा परां शान्तिमचिरेणाधिगच्छति॥", author: "Bhagavad Gita 4.39" },
            { text: "मनः प्रसादः सौम्यत्वं मौनमात्मविनिग्रहः। भावसंशुद्धिरित्येतत्तपो मानसमुच्यते॥", author: "Bhagavad Gita 17.16" }
        ]
    };


    function setupOracle() {
                const cards = {
            dev: { el: document.getElementById('dev-card'), quotes: QUOTES.development, index: 0 },
            love: { el: document.getElementById('love-card'), quotes: QUOTES.romantic, index: 0 },
            wise: { el: document.getElementById('wise-card'), quotes: QUOTES.wise, index: 0 },
            gita: { el: document.getElementById('gita-card'), quotes: QUOTES.gita, index: 0 } // NEW CARD LOGIC ADDED
        };


        function updateQuote(card) {
            const quote = card.quotes[card.index];
            const quoteTextEl = card.el.querySelector('.quote-text');
            const quoteAuthorEl = card.el.querySelector('.quote-author');
            gsap.to([quoteTextEl, quoteAuthorEl], {
                opacity: 0, duration: 0.3,
                onComplete: () => {
                    quoteTextEl.textContent = `“${quote.text}”`;
                    quoteAuthorEl.textContent = `— ${quote.author}`;
                    gsap.to([quoteTextEl, quoteAuthorEl], { opacity: 1, duration: 0.3 });
                }
            });
        }

        Object.values(cards).forEach(card => {
            updateQuote(card);
            card.el.addEventListener('click', (e) => {
                if (e.target.closest('.quote-nav')) return;
                card.el.classList.toggle('is-flipped');
            });
            const nextBtn = card.el.querySelector('.next-quote');
            const prevBtn = card.el.querySelector('.prev-quote');
            nextBtn.addEventListener('click', () => {
                card.index = (card.index + 1) % card.quotes.length;
                updateQuote(card);
            });
            prevBtn.addEventListener('click', () => {
                card.index = (card.index - 1 + card.quotes.length) % card.quotes.length;
                updateQuote(card);
            });
        });
    }

    setupOracle();

    </script>
</body>
</html>
